# 健康管理与分析信息系统

健康管理分析系统设计与实现

摘要
随着社会的快速发展,国民物质生活水平提高带来的肥胖、糖尿病、高血压等心脑血管疾病发生也越来越多。与此同时，信息技术的发展和小型化家庭化医疗设备的普及，个人健康管理的实现已不再是空中楼阁。本文首先进行了健康管理分析软件的需求分析,通过对国内外健康管理软件现状的分析,初步确定健康管理分析系统的功能需求,并在此基础上确定了系统的性能和兼容性需求,进而对系统的架构和实现模式进行总体设计。系统采用B/S架构，用户端为浏览器，服务端包括了数据库层、应用服务层和Web服务层。数据库服务层采用MySQL数据库应用服务器采用基于Python语言的Django框架开发，Web服务层使用NGINX Web 服务器。系统通过对身体健康状况的各项指标来评估健康状况,并且生成健康建议,实现了对健康信息的有效化管理。 

关键词：健康管理、健康分析、数据库技术，SQL, 信息管理 
 

Design and implementation of health management analysis system

ABSTRACT
With the rapid development of society, obesity, diabetes, hypertension and other cardiovascular and cerebrovascular diseases caused by the improvement of people's material living standard are also increasing. At the same time, with the development of information technology and the popularization of small family medical devices, the realization of personal health management is no longer a castle in the air. This paper firstly analyzes the requirements of health management analysis software. Through the analysis of the current situation of health management software at home and abroad, the functional requirements of health management analysis system are preliminarily determined. On this basis, the performance and compatibility requirements of the system are determined. The system adopts B/S architecture, the client is the browser, and the server includes database layer, application service layer and Web service layer. The database service layer adopts MySQL database application server and Django framework based on Python language. The web service layer uses NGINX web server. The system evaluates the health status through various indicators of the physical health, and generates health Suggestions, realizing the effective management of health information.

Key words: health management, health analysis, database technology, SQL, information management

 

 

 

 


目录
1.	引言	5
1.1.	研究背景及意义	5
1.2.	要求	6
1.3.	目标	7
2.	需求分析	8
2.1.	可行性分析	8
2.1.1.	市场分析	8
2.1.2.	经济可行性	11
2.1.3.	技术可行性	11
2.2.	需求调查	12
2.3.	体检健康管理业务流程分析	14
2.4.	体检健康管理数据流程分析	14
2.5.	系统的目标	15
2.5.1.	系统的功能需求	15
2.5.2.	性能需求	19
2.5.3.	输入输出需求	19
3.	系统分析	21
3.1.	系统的子系统划分	21
3.2.	系统的业务流程	21
3.3.	系统的数据流程	22
4.	系统设计	23
4.1.	系统配置设计	23
4.2.	硬件配置设计	23
4.2.1.	软件配置设计	23
4.2.2.	网络配置设计	23
4.3.	系统结构设计	23
4.3.1.	系统功能结构设计	26
4.3.2.	系统网络结构设计	27
4.4.	系统功能模块设计	27
4.4.1.	用例分析	27
4.4.2.	功能模块设计	30
4.5.	数据库设计	37
4.5.1.	概念结构设计	38
4.5.2.	逻辑结构设计	46
4.5.3.	物理结构设计	55
4.6.	输入输出界面设计	72
4.6.1.	输入界面设计	73
4.6.2.	输出界面设计	86
4.7.	代码设计	100
4.7.1.	视图代码	100
4.7.2.	模型类	106
4.7.3.	健康管理分析类代码	108
4.7.4.	模板代码	122
4.7.5.	前端动态绘图显示代码	126
5.	系统测试	130
5.1.	系统测试环境	130
5.1.1.	测试的硬件环境	130
5.1.2.	测试的软件环境	130
5.1.3.	测试的网络环境	130
5.2.	系统测试内容	130
5.3.	系统测试方法	131
5.4.	系统测试数据	131
5.5.	系统测试结果分析	136
7.	参考文献	140

 

 

1.	引言

1.1.	研究背景及意义
健康管理是20世纪50年代末最先在美国提出的概念（Managed Care），其核心内容医疗保险机构通过对其医疗保险客户（包括疾病患者或高危人群）开展系统的健康管理，达到有效控制疾病的发生或发展，显著降低出险概率和实际医疗支出，从而减少医疗保险赔付损失的目的。
健康管理以现代健康概念和新的医学模式以及中医治未病为指导，通过采用现代医学和现代管理学的理论、技术、方法和手段，对个体和群体整体健康状况及其影响健康的危险因素进行全面检测、评估、有效干预与连续跟踪服务的医学行为及过程。其目的是为了，最小投入获取最大的健康效益。通过以预防和控制疾病发生与发展，降低医疗费用，提高生命质量为目的。
2016年8月召开的全国卫生与健康大会上，习近平总书记提出 “将健康融入所有政策，人民共建共享”，强调“没有全民健康，就没有全面小康。要把人民健康放在优先发展的战略地位”。同年10月，中共中央、国务院印发《健康中国“2030”规划纲要》，提出“普及健康生活、优化健康服务、完善健康保障、建设健康环境、发展健康产业”五方面的战略任务。国民健康不仅是民生问题，也是重大的政治、经济和社会问题。健康中国建设不仅直接关乎民生福祉，而且关乎国家全局与长远发展、社会稳定和经济可持续发展，具有重大的战略意义。党的十九大报告更是将实施健康中国战略纳入国家发展的基本方略，将“实施健康中国战略”作为国家发展基本方略中的重要内容，把人民健康置于“民族昌盛和国家富强的重要标志”地位，表明健康中国建设进入了全面实施阶段。因此，关注健康、促进健康将成为国家、社会、个人及家庭的共同责任与行动。
健康是人民最具普遍意义的美好生活需要，失去健康，导致民众的生活质量降低，使其难以安居乐业，因病致贫返贫，从而导致社会矛盾激化；同时健康也是最大的生产力，中国已进入通过提高人力资本提升全社会劳动生产率，实现人口红利从数量型向质量型转换，并助力经济和综合国力持续健康发展的新阶段。鉴于中国近14亿的庞大人口规模，个体健康指标的改善将汇集为全社会巨大的健康人力资本提升。微观层面，对于企业而言，维护员工的职业安全和健康也是有效的人力资本投资手段，有助于提升企业生产率和核心竞争力。
我国健康领域实际上以疾病治疗为中心，将重点集中在解除疾病的医疗问题上。而实际上医学治疗对健康的影响有限，个人行为和日常生活习惯等才是健康更关键的决定因素，因此实现从疾病治疗到健康管理转变，健康管理成为我们每个人必须面对的重要因素。
2000年以来我国老龄化进程逐步加速，全国65岁及以上老年人占总人口比从1982年的4.9%，上升到2001年的7.1%，2016年达10.8%。而疾病谱从以传染性疾病为主加速转向以高血压、糖尿病、心血管疾病、呼吸系统疾病、脑卒中、肿瘤等慢性非传染性疾病为主。慢性病患者年轻化趋势明显。在每年1030万死亡病例中慢性非传染性疾病占比超过 80%。据统计，中国城乡居民主要疾病死因为心脑血管病、恶性肿瘤、呼吸系统疾病等慢性疾病，研究表明吸烟、过量饮酒、身体活动不足和高盐、高脂等不健康饮食是中国慢性病发生和发展的主要行为危险因素。因此以我国中医“上工治未病，不治已病”为目标，实现疾病的“治疗为主”向“预防和控制”为主的转变，以健康管理为切入点，通过充分利用个人健康信息，实现个人健康跟踪评估，并提供健康干预，改变行为和生活习惯，从而实现提高个人身体素质和生活质量，对我国建设小康社会具有重大的意义。
因此通过本次数据库课程设计，针对以上背景，设计一个较完善的有实际意义的健康管理数据库，加深对数据库系统、程序设计语言和软件工程的理论知识的理解和应用水平。
1.2.	要求
按照软件工程中的软件生命周期来设计应用系统,有如下内容:
1）问题定义；2）可行性分析；3）需求分析；4）总体设计；5）详细设计；6）编码与单元调式；7）综合测试；8）软件维护（详见数据库课程设计模板）
2、数据库设计，
使用E-R图设计概念模型；要设计逻辑模型和物理模型
3、要考虑规范化和实际应用需要，一般要求达到三范式(3NF)
4、完整性设计    
关系模型的三类完整性约束条件在设计的过程中是必须考虑的，数据之间的关联应详细说明，要求使用DBMS对联系进行适当定义和编辑。对有些统计数据可使用触发器。
5、安全性设计     
数据库的安全性是至关重要的，建议为系统设置用户管理功能，系统的用户至少分为两级：系统管理员和一般用户。不同级别的用户可操作的功能是不一样的。
6、系统体系结构
系统体系结构设计采用B/S模式。
7、应用程序功能设计   
应用系统的基本功能应根据实际目标来设定，通常有增、删、改、查、打印、备份、恢复、密钥等功能。
8、完成时间
在课程设计期间按要求完成设计任务，本学期第17周五课设任务结束。
9、提交内容
课设报告、设计系统的源代码文件、桌面录象演示三类文件，都刻在光盘上。助教收齐统一提交。同时在17周进行系统远程网上运行检查。
1.3.	目标
随着信息技术的发展和小型化家庭化医疗设备普及，为个人健康管理的实现奠定了基础，通过以管理个人及群体的健康危险因素的过程为宗旨，针对人们关注健康的主动性，以健康保健、医疗科学为基础，对个人健康状况信息进行收集管理，运用信息和医疗技术,通过科学、完善、个性化的健康评估及健康干预, 使用户建立有序的生活方式,达到改变生活习惯、提高健康水平、降低疾病发生率，从而实现节约医疗资源、降低诊疗费用、提高生活质量的目标。而健康管理人员通过对普通人群逐步积累的健康大数据研究，分析影响健康的相关因素、各因素的重要性及其变化规律，精确掌握疾病谱的发展变化及地区间疾病区域结构分布，针对当地居民主要健康问题因地施策，采取相应的预防和医疗干预措施，建立更有针对性和科学性的相关决策。
 

2.	需求分析
2.1.	可行性分析
2.1.1.	市场分析
1、国内外健康管理现状
20世纪50年代末,健康管理作为一种新型医疗模式出现在美国保险业。1973年,美国联邦为健康维护组织(Health Management Organization,简称HMO),提供了立法,即《健康维护法案》,以控制不断上升的医疗支出。自1987年开始,美国太平洋联合铁路公司为员工提供健康管理服务——“健康轨道”,控制和干预诸如高血压、高血脂10个危险因素,目前己覆盖了5万人群。通过长期的健康管理,总体的费用效益比是1:3.21,为公司每年节约了近4000万美元。至今享用PPO计划的美国人己超过9000万,这意味着70%的美国人享有健康管理服务。
1962年,芬兰成立了“健康促进中心”,卫生工作由健康教育转移到健康促进。1972年,北卡累利阿省开始实施以社区为基础,改变人们的行为方式的健康干预项目。5年后,该省居民的行为方式发生了很大改变,风险因素大幅降低,健康干预项目在芬兰的全国范围内开始推广。芬兰逐步探索了新型健康管理模式,即通过改变人们的生活习惯,并发挥基层社区中卫生服务机构的预防功能,从而从源头上降低疾病危险因素。据报道,芬兰在1972-1977年男性冠心病死亡率下降24%,女性冠心病死亡率下降51%；1972-1982年男性心绞痛患病率下降23%,1972-1977年脑卒中发病率下降30%。此外,德国、英国等国家也建立了不同形式的健康管理组织。
我国以健康管理注册的公司出现在1998年,北京耀华康业,是第一家专业提供以改善和优化生活方式作为非药物治疗的健康管理服务的公司。2003年SARS危机的出现,以及2005年10月原劳动和社会保障部正式推出的新职业——“健康管理师”,有力地推动了健康管理专业在中国的发展。比较成功的是慈铭体检机构,2004年开始创建,至今已经形成了科学规范的标准体系,创造了168个体检模块,38个体检套.目前客户量已经超过40万人,每一位客户都有身体档案,通过分析体检数据给予建议,管理客户的健康,降低客户疾病治疗的成本。
2、用户基础分析
随着国家经济水平的发展、医疗水平的提升及健康保障体系的完善，人均期望寿命不断延长。但与此同时，由于受到慢性病等因素的影响，健康状况却并没有跟上寿命增长的脚步。
世界卫生组织在过去 30 年内，连续开展了4次人群健康研究，并使用健康期望寿命（HALE）来评价一个人在完全健康的状态下的可以存活多少岁。结果显示在过去近 30年的时间内，人均期望寿命增加了 9.4 年；而人均健康期望寿命则仅增加 8.0 年。这就意味着，有更多的人会在不健康的情况下生活更长的时间。

图1：1996-2016 中国人均期望寿命变化趋势

随着中国经济的蓬勃发展，人民生活水平不断提升，伴随互联网的兴起和高速发展，也让公众的生活方式发生极大的改变，公众对于健康也愈加重视，丁香医生和健康报移动健康研究院联合发布的《2019 国民健康洞察报告》中“健康” 这一选项在公众心目中的重要性，高达 9.6 分。

图2：《2019 国民健康洞察报告》健康重视程度

《2019国民健康洞察报告》的调查中，当把身体健康与财富、工作进行比较时，93% 的公众认为身体健康是最重要的事，“幸福家庭”和“心理健康”分列二三位。 公众对于健康的重视程度，远远超过“拥有财富” 和“满意的工作”。

图3：《2019 国民健康洞察报告》重视程度评级

而对自身实际健康情况进行评价中，只有 10% 的人认为自身健康状况在 6 分及以下。公众中健康状况的自评平均分仅 6.8，刚刚超过及格线。

图4：《2019 国民健康洞察报告》公众健康程度自评

图5：《2019 国民健康洞察报告》不同年龄自评健康得分

而在 70 前、70 后、80 后、90 后四个年龄段的人群中，年龄越小，对于健康的自评则呈现阶梯式下降的趋势。尤其是 80 后、90 后年轻人，同时面临着职场压力和生活压力，健康自评分数均未达到 7 分。健康问题不再是中老年人的关注专用问题，反而成为 80  后、90 后人群的流行词，健康问题已成为社会各个阶层关注重点，因此健康管理具有了广泛的用户应用基础。
2.1.2.	经济可行性
随着人们对健康的日益重视，特别是新冠肺炎疫情的全球爆发，使人们更加迫切的认识到身体健康的重要性，健康管理具有广阔的市场前景，系统所使用的软硬件投入较低，特别是云计算技术的发展，服务器端甚至可以不购买而采用租用方式，可以按照用户量的增加按需购置，而通过健康管理获取的直接或间接经济效益巨大，因此在经济上具有较强的可行的。
2.1.3.	技术可行性 
1、客户端终端软硬件
2019年互联网络信息中心（CNNIC）发布了第43次《中国互联网络发展状况统计报告》显示，我国网民规模达8.29亿，全年新增网民5653万，互联网普及率达59.6%，较2017年底提升3.8个百分点。可以看到随着互联网的普及为网络应用奠定了客户端普及的软硬件基础，而随着电子元件的微型化和集成化，智能体重秤、智能血压计、智能血糖仪等终端健康设备逐渐的普及到各个家庭，为健康管理提供了健康数据获取的硬件基础。
2、软件开发技术
目前网络系统的开发和数据库技术非常成熟，很多商用和开源数据库系统可以满足数据的存储和高速查询，而Python、Java、C、PHP等具有很多成熟的框架，可以快速构建出应用系统，特别是B/S构架的系统，通过构建服务器端的系统，部署到互联网上，而用户只需要一个终端设备，可以使用互联网，利用浏览器就可以访问系统。
2.2.	需求调查
通过对近年来疾病谱的变化分析，我国已从原来的以传染性疾病为主转变为慢性非传染性疾病为主，其中每年1030万死亡病例中慢性非传染性疾病占比超过 80%，中关村新智源健康管理研究院、中南大学健康管理研究中心与社会科学文献出版社共同发布的《健康管理蓝皮书：中国健康管理与健康产业发展报告（2018）》中数据显示，我国慢性病发病人数在3亿左右，其中65岁以下人群慢性病负担占50%。我国城市和农村因慢性病死亡占总死亡人数的比例分别高达85.3%和79.5%。国人罹患的主要慢性病为：高血压病（94.24‰）、脂肪肝（62.78‰）、血脂异常（38.64‰）、糖尿病（34.02‰），据医学机构调查发现，亚健康是大多数慢性非传染性疾病的疾病前状态，大多数恶性肿瘤、心脑血管疾病和糖尿病等均是从亚健康人群转入。

图6：1990-2010年中国居民10位死因及死亡率

世界卫生组织对全球性调查结果表明，全世界70%左右的人处于亚健康状态。数据显示，我国人口中处于亚健康的状态，约占总人口75%。

图7：中国健康与亚健康人群分布比例

《健康管理蓝皮书：中国健康管理与健康产业发展报告（2018）》通过对132178名人员进行的“国人健康水平影响因素及干预策略研究”发现，普遍的慢性病危险因素基本上都与生活、生产方式以及环境密切相关，约45%的人群为超重或肥胖；25%的人为现患吸烟者；35%的人为现患饮酒者。
通过研究分析发现，慢性病危险因素的多向协同作用主要表现为一因多果、一果多因、多因多果和互为因果的交又关系,多个危险因素的并存将使个体发病风险倍增,而不是简单的单个危险因素风险相加。

图8：慢性病危险因素作用图

慢性病危险因素分为可改变的危险因素和不可改变的危险因素两大类。其中,可改变的危险因素如果没有得到有效控制,便可进一步演变为中间危险因素并导致各种慢性病的发生。之所以称之为中间危险因素,是因为它们既是可改变危险因素和不可改变危险因素共同作用所带来的异常结果,同时也是导致多种慢性病发生的直接危险因素,换言之,中间危险因素既是上游危险因素的结果,也是下游疾病的原因。慢性病不可改变的危险因素包括年龄、性别、种族、遗传; 慢性病可改变的危险因素主要为吸烟、过量饮酒、不合理膳食、缺乏身体活动、不良心理精神因素以及自然和社会环境因素等;中间危险因素主要包括高血压、高血糖、血脂异常、超重或肥胖等。

不可改变的危险因素	可改变的危险因素	中间危险因素
年龄	吸烟	高血压
性别	饮酒	高血糖
种族	不合理膳食	血脂异常
遗传	缺乏身体活动	超重或肥胖
表1：慢性病危险因素分类

通过研究发现医学治疗对健康的影响有限，从健康->亚健康->疾病的过程，大部分的疾病是一个从量变到质变的过程，其中个人行为和日常生活习惯是最终导致疾病的决定因素，从“每个人是自己健康第一责任人”的理念出发，通过健康管理监控主要慢性病的危险因素，对个人健康情况动态监控分析和健康干预，改进用户健康的行为和生活方式，而达到降低用户患病可能性和延缓患病的时间，实现“以疾病治疗为中心”的传统医疗模式向从“以健康为中心”健康管理模式转变。
2.3.	体检健康管理业务流程分析
上世纪 90 年代以来西方发达国家大部分 医疗机构 都已经完成了医疗信息数字化的建设工作，建立了较为完善的健康管理评估系统。但与国内不同的是他们更多的关注数字资源的提供，而较少强调高度的系统集成。由于当时技术研制，主要采用C/S 结构具有系统响应快、操作界面形式多样、有较强的事务处理能力。但是，也造成了构建出来的系统兼容性差、开发成本高，需要专门的客户端安装程序，分布功能弱，不能够实现快速部署安装和配置，对用户的使用和普及有较高的要求。
健康管理对我国来说,属于刚刚起步阶段, 随着“健康中国2030”战略的开展,目前健康管理已一定的规模,目前我国的健康管理的发展模式主要是以医院或体检中心为主体，主要以盈利为主,费用由个人或企业支付,未体现群体性和社会性，其服务对象主要是企业或高收入群体,处于贵族化的管理阶段,不能满足普通群众对健康管理服务有效和便利的需求，建立的健康管理系统主要以体检为数据收集的主要手段，通过体检中心实现健康信息的采集，普通个人不缴费体检无法使用其服务，因此使用范围较窄，其主要业务流程如下:

图9：医院或体检中心业务流程图

2.4.	体检健康管理数据流程分析


图10：医院或体检中心数据流程图


2.5.	系统的目标
2.5.1.	系统的功能需求
系统需要实现以下功能: 
1、健康信息管理： 
系统需要实现对个人的基本信息（年龄、性别等）、吸烟史、饮酒史、糖尿病史、身高、体重、血压、血脂等可能影响健康的危险因素的健康信息动态收集和管理。 
健康评估： 
系统可利用收集的个人的基本信息、吸烟史、饮酒史、糖尿病史、身高、体重、血压、血脂等相关健康信息，通过健康管理数学模型进行健康风险分析，发现身体存在的危险因素，跟踪正常与不正常的身体变化，评估健康状况，预测疾病隐患。从而为预防、治疗提供参考，以便提前采取有效的应对措施。包括日常习惯评估、BMI体重健康评估、血压健康评估、血脂健康评估、缺血性心血管病发病风险评估等。相应的评估标准和方法如下：
（1）体重评估标准
BMI 分类	WHO标准	亚洲标准	中国参考标准	相关疾病发病的危险性
体重过低	BMI<18.5	BMI<18.5	BMI<18.5	低（但其它疾病危险性增加）
正常范围	18.5≤BMI<25	18.5≤BMI<23	18.5≤BMI<24	平均水平
超重	BMI≥25	BMI≥23	BMI≥24	增加
肥胖前期	25≤BMI<30	23≤BMI<25	24≤BMI<28	增加
I度肥胖	30≤BMI<35	25≤BMI<30	28≤BMI<30	中度增加
II度肥胖	35≤BMI<40	30≤BMI<40	30≤BMI<40	严重增加
Ⅲ度肥胖	BMI≥40.0	BMI≥40.0	BMI≥40.0	非常严重增加
表2：体重评估标准
（2）血压评估标准
分类	收缩压(mmHg)	舒张压(mmHg)
低血压	<90	<60
正常	90-140	60-90
高血压	>140	>90
表3：血压评估标准
（3）血脂四项（总胆固醇、甘油三酯、高密度脂蛋白、低密度脂蛋白）正常范围
总胆固醇：2.35～5.17mmol/L
甘油三酯：0.51～1.7mmol/L
高密度脂蛋白：1.16～1.42mmol/L
低密度脂蛋白：0.25～3.11mmol/L
（4）缺血性心脑血管疾病十年发病风险评估步骤及标准

表4：缺血性心脑血管疾病十年发病风险评估步骤及标准表

2、	健康标准管理： 
3、	系统需实现对健康评估数学模型中使用的以上健康参数进行管理，包括BMI体重健康评估标准、单项评估标准、ICVD年龄评估标准、ICVD体重评估标准、ICVD吸烟评估标准、ICVD糖尿病评估标准、ICVD血压评估标准、ICVD血脂评估标准、ICVD十年发病风险评估标准、ICVD十年发病风险常规标准、健康指标分类、健康风险分析、健康风险干预等健康标准、健康分析参数、健康干预建议等进行管理维护。
4、	健康分析： 
5、	系统可利用数据分析算法实现按地区对吸烟人群、饮酒人群、肥胖人群、糖尿病人群、高血压人群和高血脂人群的分布进行单项分析以及分地区不良习惯和慢性病人群分布的综合分析，以对不同地区进行综合健康干预和政策指定提供依据。 
6、	系统管理与设置： 
7、	系统应实现用户注册、登陆、注销、修改密码；用户组建立、查询、修改、删除；用户的建立、修改、查询、分组；对不同类型用户进行组权限、用户权限、用户状态以及其它的维护管理和维护操作。
 

图11：系统功能图

2.5.2.	性能需求
1. 查询响应
健康管理分析系统应具有可快速响应的特性，用户打开界面和提交事务的平均响应时间应<3秒，用户进行在线实时查询操作的数据处理时间应<5秒。
2、并发性
健康管理分析系统应具有较强得并发性，用户连接限制数不得低于50个，以便提供快速的并发用户响应速度。
3、可靠性
健康管理分析系统应具有较高的稳定性和可靠性，系统需提供7*24的不间断服务。系统需合理的利用资源，保证前后台数据操作的效率，以及在数据响应和界面承载方面都要达到不会出现操作无反应、界面混乱、数据报错、触发按钮功能缺失、操作频繁或者快速容易崩溃的问题。
4、兼容性
健康管理分析系统应具有较强的兼容性，客户端应采用具有能够适配手机、平板电脑、笔记本、台式电脑的能力，能够适应不同操作系统下的各大主流浏览器的能力。
5. 可伸缩性
要求在不用修改系统架构的情况下，通过增加或增强相应的设备即可实现系统功能的扩展支持，能够通过增加硬件资源提高目标平均性能和峰值性能（即响应时间、延迟等）及目标平均负荷和峰值负荷（即并发用户、信息量等）。能够通过增加应用服务器及实现应用服务器负载均衡、多节点等措施提高目标平均性能和峰值性能（即响应时间、延迟等）及目标平均负荷和峰值负荷（即并发用户、信息量等）。
2.5.3.	输入输出需求
1、系统的界面需求
页面内容：主题突出，站点定义、术语和行文格式统一、 规范、明确，栏目、菜单设置和布局合理,传递的信息准确、及时，内容丰富,文字准确，语句通顺，专业术语规范，行文格式统一、规范。
技术环境：页面大小适当；无错误链接和空链接；采用css技术，控制字体大小和版面布局。使页面更加美观。
艺术风格：界面，版面形象清新悦目，布局合理，字号大小适宜，字体选择合理，前后一致，美观大方；动静搭配恰当，效果好；色彩和谐自然，与主题内容相协调。
页面布局: 符合视觉最佳适应效果。
2、输入需求
系统提供输入界面，使用户可以录入、修改、删除个人健康信息，输入界面清晰、明确、方便、已用，根据不同用户的类别，按照其权限和习惯提供方便的输入界面。
3、输出需求
 系统的输出界面要清晰、醒目，色彩和谐自然，能够以图表和文本多种方式显示，可实现打印输出，图形可下载保存为外部文件。


3.	系统分析

3.1.	系统的子系统划分
系统按照用户的类别，针对其功能划分为以下六个子系统：健康信息管理子系统、健康评估子系统、健康标准管理子系统、健康分析子系统、用户权限管理子系统、系统设置子系统。
3.2.	系统的业务流程
通过个人用户通过录入个人健康信息，利用健康评价模型通过健康评价标准对个人健康状况进行健康评估，对评估结果利用健康干预策略对个人行文和生活习惯进行健康干预，最终结果通过个人健康指标的变化反馈到系统的个人健康信息中。
健康管理用户通过对群体健康信息，利用进行分析健康评价模型通过健康评价标准对群体健康状况进行大数据分析总结规律，调整健康干预策略，在通过健康干预，最终通过个人健康指标的变化反馈到系统的个人健康信息中。

图12：健康管理分析系统业务流程分析

3.3.	系统的数据流程

图13：健康管理分析系统数据流程图
 

4.	系统设计

4.1.	系统配置设计
系统采用B/S架构（Browser/Server，浏览器/服务器模式），用户端为浏览器，服务端为服务器。
4.2.	硬件配置设计
由于客户端为浏览器，无需配置客户端设备，服务器端采用了可伸缩设计，初期用户较少时，可将数据库服务器、应用服务器和Web服务器合并安装，只需配备1台物理服务器，配置如下：
CPU:Intel  Xeon E5-2400四核四线程， 内存16G ，SATA热插拔4T硬盘RAID10，双千兆网卡
随着用户量的增加，可将数据库服务器、应用服务器、Web服务器分离，并通过负载均衡，增加吞吐量、加强网络数据处理能力、提高网络的灵活性和可用性。
4.2.1.	软件配置设计
服务器端操作系统：Linux服务器（CentOS7或Ubuntu20LTS）或Windows2016 Server。
Web服务器： NGINX或Apache 2.0
Python：Python 3.6以上
Django：Django 3.0以上
MySQL ：MySQL 7.0以上
4.2.2.	网络配置设计
服务端网络采用千兆有线网络，通过路由器接入INTERNET，可增加防火墙提高网络安全性。在网络的设计上可采用链路聚合，提高网路带宽和网络的可靠性。
客户端网络要求采用有线和无线网络，具有INTERNET访问权限，由于输入输出主要为数据，无大量的图像传输，因此要求1M以上带宽。
4.3.	系统结构设计
系统采用B/S架构（Browser/Server，浏览器/服务器模式），用户端为浏览器，服务端包括了数据库层、应用服务层和Web服务层。
数据库服务层采用MySQL数据库，MySQL是开源的关系型数据库，被广泛使用的数据库系统，最早由瑞典MySQL AB公司开发，已多次易主，目前属于Oracle公司，其具有以下的特点：
	MySQL数据库是用C和C++语言编写的，并且使用了多种编辑器进行测试，以保证源码的可移植性
	支持多个操作系统，例如：Windows、Linux、Mac OS等等；
	支持多线程，可以充分的利用CPU资源；
	为多种编程语言提供API，包括C语言、Java、PHP、Python语言等；
	MySQL优化了SQL算法，有效的提高了查询速度；
	MySQL内提供了用于管理，检查以及优化数据库操作的管理工具；
	它能够作为一个单独的应用程序应用在客户端服务器网络环境中，也可以作为一个库嵌入到其他的软件中并提供多种语言支持。
应用服务器采用基于Python语言的Django框架开发，Django 是一个开放源代码的 Web 应用框架，由 Python 语言开发。Django 采用了 MVT 的软件设计模式，它是MVC模式的变种。
MVC 模式（Model–View–Controller）是软件工程中的一种软件架构模式，把软件系统分为三个基本部分：模型（Model）、视图（View）和控制器（Controller）。
MVC 以一种插件式的、松耦合的方式连接在一起。
模型（M）- 编写程序应有的功能，负责业务对象与数据库的映射(ORM)。
视图（V）- 图形界面，负责与用户的交互(页面)。
控制器（C）- 负责转发请求，对请求进行处理。

图14：MVC用户-系统交互流程图

Django 的 MTV 模式本质上和 MVC 一致，也是为了各组件间保持松耦合关系，只是定义上有些许不同，Django 的 MTV 分别是指：
M 表示模型（Model）：负责数据储存在的服务器端基本结构，以及数据别名、验证信息等一些基础内容，实现业务对象与数据库的映射(ORM)。
T 表示模板 (Template)：负责后端传来的数据通过页面(html)展示给用户及前端的交互操作。
V 表示视图（View）：实现业务逻辑，既负责与数据库做沟通增删改查，也负责加工数据决定什么数据传到前端。因此视图也是模型和模板的桥梁，在适当时候调用 Model和 Template。
MTV 的响应模式如下所示：

图15：MTV响应模式图
除了以上三层之外，Django通过URL 分发器将URL 的页面请求分发给不同的 View 处理，View 再调用相应的 Model 和 Template： 

图16：MV用户-系统交互流程图
4.3.1.	系统功能结构设计
系统功能结构设计主要分为客户层、web服务层、WSGI服务层、应用服务层、数据服务层和数据存储层，如下图所示： 

图17：系统功能结构架构图

客户层：用户通过浏览器与系统进行交互，浏览器发出HTTP请求，系统处理后返回HTTP应答。
Web服务层：由NGINX或Apache Web服务器处理HTTP请求，根据请求的不同类型分别处理，如果是静态页面由Web服务器进行处理，否则发送uWSGI请求给WSGI服务层，同时本层可实现负载均衡，是系统具有较强的可伸缩性。
WSGI服务层：负责处理uWSGI请求与响应，根据请求的内容并向应用服务层发出WSGI请求，并将WSGI响应返回给Web服务层
应用服务层：通过中间件服务实现了Session、Security、CsrfView、Authentication、Message、XFrameOptions等服务，并通过URL控制器调用相应的View处理业务逻辑，通过Model实现数据的处理，并通过Template将结果返回。
数据服务层：通过ORM数据映射服务实现数据模型到数据库数据的访问，文件服务完成文件系统访问。
数据存储层：通过MySQL数据库服务器和文件系统，完成数据和文件的存取。
4.3.2.	系统网络结构设计
  系统的网络结构如图所示，Web服务器、应用服务器和数据库服务器接入互联网，用户通过手机、平板、笔记本、个人计算等终端设备通过互联网访问系统。
 系统在网络结构的设计具有可伸缩性，才系统初期可将Web服务器、应用服务器和数据库服务器合并使用一台物理服务器联入Internet，随着用户量的增加，可根据需要将数据库服务器、应用服务器和Web服务器分离，Web服务器处理静态Web页面、应用服务器负责业务逻辑、数据库服务器负责数据处理和存储，并分别使用多台物理设备实现分布式处理，实现网络流量的分流。

图18：系统网络结构图

4.4.	系统功能模块设计
4.4.1.	用例分析
系统使用人员主要为个人用户、健康管理用户以及管理员，下面对系统的使用人员进行用例分析。 
个人用户
匿名用户通过注册成为个人用户，登陆系统后，录入、修改、删除和查询自己的健康信息（包括基本信息、吸烟糖尿病史信息、身高体重信息、血压信息、血脂信息等个人健康数据），并可以对自己的健康信息进行健康评估（包括日常习惯评估、BMI体重健康评估、血压健康评估、血脂健康评估、缺血性心血管病发病风险评估），可以修改密码和注销登出系统。 
健康管理用户
个人用户可以通过管理员授权成为健康管理用户，登陆系统后，可以录入、修改、删除和查询自己的健康信息（包括基本信息、吸烟糖尿病史信息、身高体重信息、血压信息、血脂信息等个人健康数据），并可以对自己的健康信息进行健康评估（包括日常健康评估、BMI体重健康评估、血压健康评估、血脂健康评估、缺血性心血管病发病风险评估），可以修改密码和注销登出系统。 
健康管理用户可对健康标准信息进行录入、修改、删除和查询（包括BMI体重健康评估标准、单项评估标准、ICVD年龄评估标准、ICVD体重评估标准、ICVD吸烟评估标准、ICVD糖尿病评估标准、ICVD血压评估标准、ICVD血脂评估标准、ICVD十年发病风险评估标准、ICVD十年发病分线常规标准、健康指标分类、健康风险分析、健康风险干预等健康标准、健康分析参数、健康干预建议等）。
健康管理用户可通过健康分析按地区对吸烟人群、饮酒人群、肥胖人群、糖尿病人群、高血压人群和高血脂人群的分布进行单项分析以及分地区不良习惯和慢性病人群分布的综合分析。
管理员用户
个人用户和健康管理员用户可以通过管理员授权成为管理员用户，登陆系统后，可以录入、修改、删除和查询全部用户的健康信息（包括基本信息、吸烟糖尿病史信息、身高体重信息、血压信息、血脂信息等个人健康数据），并可以对自己的健康信息进行健康评估（包括日常习惯评估、BMI体重健康评估、血压健康评估、血脂健康评估、缺血性心血管病发病风险评估），可以修改密码和注销登出系统。 
管理员用户可对健康标准信息进行录入、修改、删除和查询（包括包括BMI体重健康评估标准、单项评估标准、ICVD年龄评估标准、ICVD体重评估标准、ICVD吸烟评估标准、ICVD糖尿病评估标准、ICVD血压评估标准、ICVD血脂评估标准、ICVD十年发病风险评估标准、ICVD十年发病分线常规标准、健康指标分类、健康风险分析、健康风险干预等健康标准、健康分析参数、健康干预建议等）。
管理员用户可通过健康分析按地区对吸烟人群、饮酒人群、肥胖人群、糖尿病人群、高血压人群和高血脂人群的分布进行单项分析以及分地区不良习惯和慢性病人群分布的综合分析。
管理员用户可对通过系统设置对系统进行维护操作（包括修改系统的名称、LOGO、提示信息，增加、删除、修改系统菜单的名称、位置、权限、排序和状态等），可以通过认证授权增加、修改、删除用户和用户组，并对用户和用户组进行权限管理。

图19：系统用例图模型 

图20：健康信息管理用例包含子用例关系模型

图21：健康评估用例包含子用例关系模型

图22：健康标准管理用例包含子用例关系模型

图23：健康分析用例包含子用例关系模型

4.4.2.	功能模块设计
1、用户注册
用户通过注册界面，输入注册信息，系统验证通过即完成用户注册，用户可以开始使用系统，其流程如下：

图24：用户注册流程图

2、用户登录
     用户通过登录界面，输入登录信息，系统验证通过即完成登录，其流程如下：

图25：用户登录流程图

3、数据管理流程
数据管理流程包括了个人健康信息数据管理和健康信息标准数据管理：健康信息包括基本信息、吸烟糖尿病史信息、身高体重信息、血压信息、血脂信息等个人健康数据的管理；健康信息标准包括BMI体重健康评估标准、单项评估标准、ICVD年龄评估标准、ICVD体重评估标准、ICVD吸烟评估标准、ICVD糖尿病评估标准、ICVD血压评估标准、ICVD血脂评估标准、ICVD十年发病风险评估标准、ICVD十年发病分线常规标准、健康指标分类、健康风险分析、健康风险干预等健康标准、健康分析参数、健康干预建议等数据的管理，基本流程是一致的，其流程如下：

图26：数据管理流程图

4、数据新增流程
数据新增包括了个人健康信息数据新增和健康信息标准数据新增：健康信息包括基本信息、吸烟糖尿病史信息、身高体重信息、血压信息、血脂信息等个人健康数据的新增；健康信息标准包括BMI体重健康评估标准、单项评估标准、ICVD年龄评估标准、ICVD体重评估标准、ICVD吸烟评估标准、ICVD糖尿病评估标准、ICVD血压评估标准、ICVD血脂评估标准、ICVD十年发病风险评估标准、ICVD十年发病分线常规标准、健康指标分类、健康风险分析、健康风险干预等健康标准、健康分析参数、健康干预建议等数据的新增，基本流程是一致的，其流程如下：

图27：数据新增流程图

5、数据修改流程
数据修改编辑包括了个人健康信息数据修改编辑和健康信息标准数据修改编辑：健康信息包括基本信息、吸烟糖尿病史信息、身高体重信息、血压信息、血脂信息等个人健康数据的修改编辑；健康信息标准包括BMI体重健康评估标准、单项评估标准、ICVD年龄评估标准、ICVD体重评估标准、ICVD吸烟评估标准、ICVD糖尿病评估标准、ICVD血压评估标准、ICVD血脂评估标准、ICVD十年发病风险评估标准、ICVD十年发病分线常规标准、健康指标分类、健康风险分析、健康风险干预等健康标准、健康分析参数、健康干预建议等数据的修改编辑，基本流程是一致的，其流程如下：。

图28：数据修改流程图

6、健康评估流程
健康评估包括日常健康评估、BMI体重健康评估、血压健康评估、血脂健康评估、缺血性心血管病发病风险评估，这些健康评估所依赖的健康数据不同，其所用的分析模型也各不相同，其健康干预方法也各异，但基本流程是一致的，其流程是根据个人健康信息按照评估模型进行评估分析，根据评估结果提出健康干预建议，其流程如下：

图29：健康评估流程图

7、健康分析流程
健康分析包括吸烟人群分布分析、饮酒人群分布分析、肥胖人群分布分析、糖尿病人群分布分析、高血压人群分布分析和高血脂人群分布分析和不良习惯和慢性病人群分布的综合分析，这些健康分析所依赖的健康数据不同，其所用的分析模型也各不相同，但基本流程是一致的，其流程如下：

图30：健康分析流程图

4.5.	数据库设计
在数据库设计中，应符合三范式要求，并根据实际应用的需要进行调整。
第一范式：
1、数据库表中的所有字段都只具有单一属性
2、单一属性的列是由基本的数据类型所构成的
3、设计出来的表都是简单的二维表
第二范式：
 要求一个表中只具有一个业务主键，也就是说符合第二范式的表中不能存在非主键列对只对部分主键的依赖关系
第三范式：
指每一个非主属性既不部分依赖于也不传递依赖于业务主键，也就是在第二范式的基础上消除了非主键属性对主键的传递依赖。

4.5.1.	概念结构设计
系统包含的实体主要有:个人健康用户、健康管理用户、管理员、吸烟、饮酒、糖尿病史、体重、血压、血脂等，
1、实体属性局部E-R图
（1）个人健康用户、健康管理用户、管理员

图31：个人健康用户E-R图


图32：健康管理用户E-R图


图33：健康管理员E-R图

（2）吸烟史、饮酒史、糖尿病史

图34：吸烟史、饮酒史、糖尿病史E-R图

（3）体重、血压、血脂


图35：体重、血压E-R图


图36：血脂E-R图

（4）用户权限、用户组、用户组权限

图37：用户权限、用户组、用户组权限E-R图

（5）ICVD风险评估年龄、体重、血压、血脂、吸烟、糖尿病评分表

图38：ICVD年龄、ICVD体重评分表E-R图


图39：ICVD血压、ICVD血脂评分表E-R图

图40：ICVD吸烟、ICVD糖尿病评分表E-R图

（6）ICVD十年发病风险-分数对照表和常规最小风险对照表

图41：ICVD十年发病风险-分数对照表和常规最小风险对照表

（7）单项评估标准和BMI评估标准

图42：单项评估标准和BMI评估标准E-R图

（8）健康指标分类和风险指标分类

图43：健康指标分类和风险指标分类E-R图

（9）风险分析对照表和健康干预对照表

图44：风险分析对照表和健康干预对照表E-R图

2、实体联系E-R图
（1）用户-基本信息
个人健康用户、健康管理用户和管理员三个实体均为用户，个人健康用户、健康管理用户使用系统的需求不同，均通过注册建立，通过管理员授权使其具有特性，因此注册阶段只需填写部分信息，注册后需填写详细信息，因此在设计上将其设计为两个实体：用户和基本信息，二者为1对1关系，而用户通过不同的用户组来区分个人健康用户、健康管理用户，不同的用户组具有不同的权限，管理员用户比较特殊，系统初始必须存在，可作为单独的管理用户，也可以通过授权将其它用户设置为管理员，因此我们将三类用户其抽象化为用户，并增加属性区别是否超级用户， E-R图如下：

图45：用户与基本信息关系E-R图

（2）用户-吸烟史、饮酒史、糖尿病史
吸烟史、饮酒史、糖尿病史记录了用户是否吸烟、饮酒、患糖尿病以及开始时间，因此用户与吸烟史、饮酒史、糖尿病史均为1对1关系，吸烟史、饮酒史、糖尿病史信息较少因此我们将其合并为日常习惯及糖尿病史信息，关系E-R图如下：

图46：用户-日常习惯及糖尿病史关系E-R图

（3）用户-体重、血压、血脂
 体重、血压、血脂记录了多次测量的体重、血压、血脂值，因此用户与体重、血压、血脂是1对多的关系，关系E-R图如下：

图47：用户-体重、血压、血脂局部关系E-R图

（4）用户-用户组、用户-用户权限、用户组-用户组

图49：用户-用户组、权限局部关系E-R图

（5）风险分类-风险分析、健康干预

图50：风险分类-风险分析、健康干预局部关系E-R图

4.5.2.	逻辑结构设计
逻辑结构设计将现实世界的概念数据模型设计成数据库的一种逻辑模式，即适应于某种特定数据库管理系统所支持的逻辑数据模式。逻辑设计的基本内容包括： 
	将概念模型中的每一个对象转换为关系模式； 
	进一步转换为网状、层次模型，并向特定的 DBMS 支持下的数据模型转换；
	进行关系模式的合并与调整。
本系统采用关系数据模型，在进行概念设计的 ER 模型转换为关系模型设计时，充分考虑主流关系型的特性，同时为了简化实体的管理、方便数据的录入、提高数据查询效率，对实体的设计进行了优化。
1、对类似属性的实体进行了合并，删除了部分冗余。
由于用户权限和用户组权限属性基本相同，因此对用户权限和用户组权限和并为权限；健康指标分类和风险分类均为树状结构的分类，因此合并为健康指标及风险分类。
2、对于多对多关系，为了后期开发方便，对其进行了拆分。
对于用户-组，由于一个用户可以属于多个用户组，一个用户组可以包含多个用户，我们通过建立中间表实体，拆分为两个1对多的关系，实现多对多关系。同样对于用户-权限和用户组-权限均作了相应的设计，增加了相应的中间表实体进行设计。
3、多值属性设计新的关系
对于特定多值属性，为了规范化内容，减少用户后期使用时的错误，对于多值属性进行设计，例如树状结构等
4、数据ID的设计
对实体的标识编码设计上，由于主流关系数据库都为主键设计支持自增行字段，因此在设计上均采用了自增型字段作为主键。
经过以上优化设计，全局类图如下：

图51：全局类图

通过对以上类图的属性、关系进行分析设计，转化为主流关系数据库支持的表结构，如下：
1、用户数据表(auth_user)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	password	密码	varchar	128	×	×	×	×	
3	last_login	上次登录	datetime		×	×	×	√	
4	is_superuser	超级用户状态	bool		×	×	×	×	False
5	username	用户名	varchar	150	×	×	×	×	
6	first_name	名字	varchar	30	×	×	×	×	
7	last_name	姓氏	varchar	150	×	×	×	×	
8	email	电子邮件地址	varchar	254	×	×	×	×	
9	is_staff	人员状态	bool		×	×	×	×	False
10	is_active	有效	bool		×	×	×	×	True
11	date_joined	加入日期	datetime		×	×	×	×	now()
2、基本信息数据表(healthinfo_userinfo)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	user_id	用户名	int		×	×	√	×	
3	ssn	身份证号	varchar	18	×	×	×	√	
4	birthday	出生日期	date		×	×	×	×	
5	sex	性别	varchar	1	×	×	×	×	M
6	phone	电话	varchar	11	×	×	×	×	
7	province	省	varchar	16	×	×	×	×	辽宁
8	city	市	varchar	16	×	×	×	×	盘锦
9	org	单位	varchar	30	×	×	×	√	
10	job	职位	varchar	20	×	×	×	×	工人
11	address	地址	varchar	60	×	×	×	√	
12	photo	照片	varchar	100	×	×	×	×	
3、吸烟糖尿病信息数据表(healthinfo_smokediabetesinfo)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	user_id	用户名	int		×	×	√	×	
3	smoke	吸烟	bool		×	×	×	×	False
4	smokestart	吸烟开始时间	Date		×	×	×	√	
5	drink	饮酒	Bool		×	×	×	×	False
6	drinkstart	饮酒开始时间	Date		×	×	×	√	
7	diabetes	糖尿病	bool		×	×	×	×	False
8	diabetesstart	糖尿病患病时间	Date		×	×	×	√	
4、身高体重信息数据表(healthinfo_bodyinfo)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	user_id	用户	int		×	×	√	×	
3	measuretime	测量时间	datetime		×	×	×	×	
4	height	身高(cm)	numeric	5,2	×	×	×	×	
5	weight	体重(kg)	numeric	5,2	×	×	×	×	
6	waist	腰围(cm)	numeric	4,2	×	×	×	×	
5、血压信息数据表(healthinfo_bloodpressure)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	user_id	用户	int		×	×	√	×	
3	measuretime	测量时间	datetime		×	×	×	×	
4	DBP	舒张压(mmHg)	smallint		×	×	×	×	
5	SBP	收缩压(mmHg)	smallint		×	×	×	×	
6	HR	心率	smallint		×	×	×	×	
6、血脂信息数据表(healthinfo_bcholesterin)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	user_id	用户	int		×	×	√	×	
3	measuretime	测量时间	datetime		×	×	×	×	
4	TC	总胆固醇(mmol/L)	numeric	4,2	×	×	×	×	
5	LDL	低密度脂蛋白(mmol/L)	numeric	4,2	×	×	×	×	
6	HDL	高密度胆固醇(mmol/L)	numeric	4,2	×	×	×	×	
7	TG	甘油三酯(mmol/L)	numeric	4,2	×	×	×	×	
7、健康指标分类数据表(healthinfo_indicator)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	name	指标名称	varchar	30	×	×	×	×	
3	parent_id	上级分类	int		×	×	√	√	
8、ICVD年龄评估标准数据表(healthinfo_agescale)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	sex	性别	varchar	1	×	×	×	×	M
3	maxv	年龄最大值	smallint		×	×	×	×	
4	score	分数	smallint		×	×	×	×	
9、ICVD体重评估标准数据表(healthinfo_weightscale)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	sex	性别	varchar	1	×	×	×	×	M
3	maxv	BMI最大值	smallint		×	×	×	×	
4	score	分数	smallint		×	×	×	×	
10、ICVD血压评估标准数据表(healthinfo_bloodpressurescale)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	sex	性别	varchar	1	×	×	×	×	M
3	maxv	收缩压最大值	smallint		×	×	×	×	
4	score	分数	smallint		×	×	×	×	
11、ICVD血脂评估标准数据表(healthinfo_tcscale)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	sex	性别	varchar	1	×	×	×	×	M
3	maxv	总胆固醇最大值	numeric	4,2	×	×	×	×	
4	score	分数	smallint		×	×	×	×	
12、ICVD吸烟评估标准数据表(healthinfo_smokescale)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	sex	性别	varchar	1	×	×	×	×	M
3	smoke	是否吸烟	bool		×	×	×	×	
4	score	分数	smallint		×	×	×	×	
13、ICVD糖尿病评估标准数据表(healthinfo_diabetesscale)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	sex	性别	varchar	1	×	×	×	×	M
3	diabetes	是否糖尿病	bool		×	×	×	×	
4	score	分数	smallint		×	×	×	×	
14、ICVD十年发病风险评估标准数据表(healthinfo_riskevaluatscale)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	sex	性别	varchar	1	×	×	×	×	M
3	score	分数	smallint		×	×	×	×	
4	risk	风险值%	numeric	3,1	×	×	×	×	
15、ICVD十年发病常规风险标准数据表(healthinfo_commonriskscale)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	sex	性别	varchar	1	×	×	×	×	M
3	age	年龄值	smallint		×	×	×	×	
4	avgrisk	平均风险%	numeric	3,1	×	×	×	×	
5	minrisk	最小风险%	numeric	3,1	×	×	×	×	
16、BMI评估标准数据表(healthinfo_bmiscale)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	bmi	BMI值	numeric	4,2	×	×	×	×	
3	wtype_id	体重分类	int		×	×	√	×	
17、单项评估标准数据表(healthinfo_singleassess)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	assesstype	评估类型	varchar	30	×	×	×	×	
3	assessname	评估指标	varchar	30	×	×	×	×	
4	minv	评估指标最小值	double		×	×	×	×	
5	maxv	评估指标最大值	double		×	×	×	×	
18、健康风险分析数据表(healthinfo_riskanalyse)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	hmtype_id	风险类别	int		×	×	√	×	
3	risk	风险	varchar	254	×	×	×	×	
19、健康干预建议数据表(healthinfo_healthintervent)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	hmtype_id	风险类别	int		×	×	√	×	
3	intervent	干预建议	varchar	254	×	×	×	×	
20、选项数据表(django_admin_settings_options)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	option_name	名称	varchar	255	×	×	×	×	
3	option_value	值	longtext		×	×	×	×	
4	valid	有效性	bool		×	×	×	×	True
5	create_time	创建时间	datetime		×	×	×	×	now()
6	update_time	更新时间	datetime		×	×	×	×	
21、菜单数据表(django_admin_settings_menu)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	path	path	varchar	255	×	×	×	×	
3	depth	depth	integer unsigned		×	×	×	×	
4	numchild	numchild	integer unsigned		×	×	×	×	0
5	name	名称	varchar	255	×	×	×	×	
6	position	菜单位置	varchar	255	×	×	×	×	left
7	link_type	链接类型	int		×	×	×	×	0
8	link	链接	varchar	255	×	×	×	√	
9	icon	图标	varchar	255	×	×	×	√	
10	content_type_id	关联Model	int		×	×	√	√	
11	priority_level	优先级	int		×	×	×	×	100
12	valid	有效性	bool		×	×	×	×	True
22、用户权限数据表(auth_permission)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	name	名称	varchar	255	×	×	×	×	
3	content_type_id	内容类型	int		×	×	√	×	
4	codename	代码名称	varchar	100	×	×	×	×	
23、用户组数据表(auth_group)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	name	名称	varchar	150	×	×	×	×	
24、用户-组关系数据表(auth_user_groups)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	user_id	用户ID	int		×	×	√	×	
3	group_id	组ID	int		×	×	√	×	
25、组-权限关系数据表(auth_group_permissions)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√·	×	×	
2	group_id	组ID	int		×	×	√	×	
3	permission_id	权限ID	int		×	×	√	×	
26、内容类型数据表(django_content_type)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	app_label	app label	varchar	100	×	×	×	×	
3	model	python 模型类名	varchar	100	×	×	×	×	
4.5.3.	物理结构设计
不同的数据库产品所提供的物理环境、存取方法和存储结构有很大差别，将给定逻辑结构实施到具体的环境中，逻辑数据模型需要选取一个实际的工作环境，其提供了数据存储结构与存取方法，需要根据所选择的关系型数据库的特点对逻辑模型进行存储结构设计。它涉及的内容包含以下4方面：
	选择物理数据库系统，定义数据库、表及字段的命名规范；
	选择合适的存储引擎；
	为表中的字段选择合适的数据类型；
	建立数据库结构。
数据库物理设计过程中需要对时间效率、空间效率、维护代价、经济性和各种用户要求进行权衡，选择一个优化方案作为数据库物理结构。在数据库物理设计中，最有效的方式是集中地存储和检索对象。
1、DBMS 系统的选择
在数据库的物理设计中，首先要选择DBMS 系统，下图列出了常用的数据库，不同的DBMS 系统具有不同的特点。

图52：常见DBMS系统

从性能方向考虑，Oracle性能比较高的，大量的事务操作时可选择Oracle，但价格较高；像是 SQLServer只支持在 window 操作系统，而Oracle、MySql、Pgsql能够运行在 linux、windows 下；从应用场景来看，mysql 和 pgsql 这类开源数据库比较适合互联网应用，而 oracle 和 sqlserver 更常见于企业级应用。因此DBMS的选择需要充分考虑性能、易用性、安全性、经济性的因素。
通过综合考虑以上因素，本系统选择MySQL数据库系统，MySQL数据库具有以下特点和优势:
	MySQL性能卓越、服务稳定，满足系统对于性能的要求。
	MySQL开放源代码且无版权制约，自主性及使用成本低，满足系统对于经济性的要求。
	MySQL历史悠久，用户使用活跃，在很多中小企业应用，经历了时间的检验，具有较高的安全性。
	MySQL体积小，安装方便，易于维护，满足易用性的特点。
	MySQL支持多种操作系统，支持LAMP、LNMP 等多种流行架构，提供多种API接口，支持多种开发语言。
2、存储引擎的选择
数据库存储引擎是数据库底层软件组件，数据库管理系统使用数据引擎进行创建、查询、更新和删除数据操作。不同的存储引擎提供不同的存储机制、索引技巧、锁定水平等功能，使用不同的存储引擎还可以获得特定的功能，下表列出了MySql常用的4种存储引擎的支持特性。
功能	MylSAM	MEMORY	InnoDB	NDBCluster
存储限制	256TB	RAM	64TB	None
支持事务	No	No	Yes	Yes
支持全文索引	Yes	No	No	Yes
支持树索引	Yes	Yes	Yes	Yes
支持哈希索引	No	Yes	No	Yes
支持数据缓存	No	N/A	Yes	Yes
支持外键	No	No	Yes	Yes

MyISAM存储引擎：不支持事务、也不支持外键，优势是访问速度快，对事务完整性没有要求或者以select，insert为主的应用基本上可以用这个引擎来创建表，支持静态表、动态表、压缩表3种不同的存储格式。
InnoDB存储引擎：该存储引擎提供了具有提交、回滚和崩溃恢复能力的事务安全。但是对比MyISAM引擎，写的处理效率会差一些，并且会占用更多的磁盘空间以保留数据和索引。 InnoDB存储引擎的特点：支持自动增长列，支持外键约束。
MEMORY存储引擎：使用存在于内存中的内容来创建表。每个memory表只实际对应一个磁盘文件，格式是.frm。memory类型的表访问非常的快，因为它的数据是放在内存中的，并且默认使用HASH索引，但是一旦服务关闭，表中的数据就会丢失掉。 MEMORY存储引擎的表提供BTREE索引或者HASH索引支持。 Memory类型的存储引擎主要用于哪些内容变化不频繁的代码表，或者作为统计操作的中间结果表，便于高效地对中间结果进行分析并得到最终的统计结果。
NDBCluster存储引擎：分布式存储引擎，可以由多个NDBCluster存储引擎组成集群分别存放整体数据的一部分，支持事务，可与mysqld不在一台主机：可以和mysqld分开存在于独立的主机上，然后通过网络和mysqld通信交互，内存需求量巨大：新版本索引以及被索引的数据必须存放在内存中，老版本所有数据和索引必须存在与内存中，适用具有非常高的并发需求，但对于查询简单，过滤条件较为固定，每次请求数据量较少，不很适合。
由于系统需要使用外键，因此系统选择使用InnoDB存储引擎。
3、主键、字段类型、索引的设计
	在主键的设计上，采用了InnoDB存储引擎支持自增数值型字段，它具有以下优点：
	数据库自动编号，速度快，而且是增量增长，按顺序存放，可作为聚集索引，对于检索速度快； 
	数字型，占用空间小，节省磁盘空间，易排序，在程序中传递也方便； 
	查询、写入效率高，写入效率是UUID的四倍。
	能够保证独立性，程序可以在不同的数据库间迁移，效果不受影响。
	保证生成的ID不仅是表独立的，而且是库独立的，这点在你想切分数据库的时候尤为重要。
字段类型的设计根据MySql所支持的类型进行设计，例如，对于是否管理员、是否吸烟、是否饮酒、是否患糖尿病等bool型，利用tinyint实现。
吸烟糖尿病信息数据表(healthinfo_smokediabetesinfo)
序号	字段名	字段描述	字段类型	长度	主键	自增	外键	为空	默认值
1	id	ID	int		√	√	×	×	
2	user_id	用户名	int		×	×	√	×	
3	smoke	吸烟	tinyint		×	×	×	×	False
4	smokestart	吸烟开始时间	Date		×	×	×	√	
5	drink	饮酒	tinyint		×	×	×	×	False
6	drinkstart	饮酒开始时间	Date		×	×	×	√	
7	diabetes	糖尿病	tinyint		×	×	×	×	False
8	diabetesstart	糖尿病患病时间	Date		×	×	×	√	
通过索引的设计提高检索查询的效率，索引的设计一般遵循以下原则：
	索引的设置需要充分考虑业务中的查询的需要，最适合索引的列是出现在WHERE⼦句中的列，或连接⼦ 句中指定的列，⽽不是出现在SELECT关键字后的选择列表中的列。
	使⽤唯⼀索引。索引的列的基数越⼤，索引的效果越好。例如，存放出⽣⽇期的列具有不同值，很容易区分各⾏。⽽记录性别的列，只含有“M”和“F”，则对此列进⾏索引没有多⼤⽤处，因为不管搜索哪个值，都会得出⼤约⼀半的⾏。
	尽量使⽤短索引。短索引能够节省⼤量索引空间，也可能会使查询更快。较⼩的索引涉及的磁盘 IO 较少，较短的值⽐较起来更快。
	避免过度索引。额外的索引都要占⽤额外的磁盘空间，并降低写操作的性能。创建多余的索引给查询优化带来了更多的⼯作。索引太多，只保持所需的索引有利于查询优化。
	InnoDB表尽量指定主键，当表中同时有⼏个列都是唯⼀的，按照主键或者内部列进⾏的访问最快， InnoDB 表的普通索引将保存主键键值，尽可能较短的数据类型，可以有效地减少索引的磁盘占⽤，提⾼索引的缓存效果。
在健康评估和分析中需要经常查询健康标准数据，因此对系统经常调用的系统菜单、需要经常评估和分析的健康数据建立相应的索引，对经常检索查询和健康标准数据的列建立复合索引，提高检索速度，以提高数据的检索速度：
  UNIQUE INDEX `auth_user_groups_user_id_group_id_94350c0c_uniq` (`user_id` ASC, `group_id` ASC) VISIBLE,
  INDEX `auth_user_groups_group_id_97559544_fk_auth_group_id` (`group_id` ASC) VISIBLE,
  UNIQUE INDEX `auth_user_user_permissions_user_id_permission_id_14a6b632_uniq` (`user_id` ASC, `permission_id` ASC) VISIBLE,
  INDEX `auth_user_user_permi_permission_id_1fbb5f2c_fk_auth_perm` (`permission_id` ASC) VISIBLE,
  UNIQUE INDEX `path` (`path` ASC) VISIBLE,
  INDEX `django_admin_setting_content_type_id_b94f39c2_fk_django_co` (`content_type_id` ASC) VISIBLE,
  UNIQUE INDEX `healthinfo_agescale_sex_maxv_b8f24470_uniq` (`sex` ASC, `maxv` ASC) VISIBLE)
  UNIQUE INDEX `measuretime` (`measuretime` ASC) VISIBLE,
  UNIQUE INDEX `healthinfo_bcholesterin_user_id_measuretime_7234b7d6_uniq` (`user_id` ASC, `measuretime` ASC) VISIBLE,
4、数据库结构建立
-- MySQL Script generated by MySQL Workbench
-- Fri Jun  5 16:20:50 2020
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';
-- -----------------------------------------------------
-- Schema healthmanage
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `healthmanage` ;
-- -----------------------------------------------------
-- Schema healthmanage
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `healthmanage` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci ;
USE `healthmanage` ;
-- -----------------------------------------------------
-- Table `healthmanage`.`auth_group`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`auth_group` ;

CREATE TABLE IF NOT EXISTS `healthmanage`.`auth_group` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(150) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `name` (`name` ASC) VISIBLE)
ENGINE = InnoDB
AUTO_INCREMENT = 3
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`django_content_type`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`django_content_type` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`django_content_type` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `app_label` VARCHAR(100) NOT NULL,
  `model` VARCHAR(100) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `django_content_type_app_label_model_76bd3d3b_uniq` (`app_label` ASC, `model` ASC) VISIBLE)
ENGINE = InnoDB
AUTO_INCREMENT = 27
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`auth_permission`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`auth_permission` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`auth_permission` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(255) NOT NULL,
  `content_type_id` INT(11) NOT NULL,
  `codename` VARCHAR(100) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `auth_permission_content_type_id_codename_01ab375a_uniq` (`content_type_id` ASC, `codename` ASC) VISIBLE,
  CONSTRAINT `auth_permission_content_type_id_2f476e4b_fk_django_co`
    FOREIGN KEY (`content_type_id`)
    REFERENCES `healthmanage`.`django_content_type` (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 105
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`auth_group_permissions`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`auth_group_permissions` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`auth_group_permissions` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `group_id` INT(11) NOT NULL,
  `permission_id` INT(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `auth_group_permissions_group_id_permission_id_0cd325b0_uniq` (`group_id` ASC, `permission_id` ASC) VISIBLE,
  INDEX `auth_group_permissio_permission_id_84c5c92e_fk_auth_perm` (`permission_id` ASC) VISIBLE,
  CONSTRAINT `auth_group_permissio_permission_id_84c5c92e_fk_auth_perm`
    FOREIGN KEY (`permission_id`)
    REFERENCES `healthmanage`.`auth_permission` (`id`),
  CONSTRAINT `auth_group_permissions_group_id_b120cbf9_fk_auth_group_id`
    FOREIGN KEY (`group_id`)
    REFERENCES `healthmanage`.`auth_group` (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 105
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`auth_user`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`auth_user` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`auth_user` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `password` VARCHAR(128) NOT NULL,
  `last_login` DATETIME(6) NULL DEFAULT NULL,
  `is_superuser` TINYINT(1) NOT NULL,
  `username` VARCHAR(150) NOT NULL,
  `first_name` VARCHAR(30) NOT NULL,
  `last_name` VARCHAR(150) NOT NULL,
  `email` VARCHAR(254) NOT NULL,
  `is_staff` TINYINT(1) NOT NULL,
  `is_active` TINYINT(1) NOT NULL,
  `date_joined` DATETIME(6) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `username` (`username` ASC) VISIBLE)
ENGINE = InnoDB
AUTO_INCREMENT = 177
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`auth_user_groups`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`auth_user_groups` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`auth_user_groups` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `user_id` INT(11) NOT NULL,
  `group_id` INT(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `auth_user_groups_user_id_group_id_94350c0c_uniq` (`user_id` ASC, `group_id` ASC) VISIBLE,
  INDEX `auth_user_groups_group_id_97559544_fk_auth_group_id` (`group_id` ASC) VISIBLE,
  CONSTRAINT `auth_user_groups_group_id_97559544_fk_auth_group_id`
    FOREIGN KEY (`group_id`)
    REFERENCES `healthmanage`.`auth_group` (`id`),
  CONSTRAINT `auth_user_groups_user_id_6a12ed8b_fk_auth_user_id`
    FOREIGN KEY (`user_id`)
    REFERENCES `healthmanage`.`auth_user` (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 177
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`auth_user_user_permissions`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`auth_user_user_permissions` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`auth_user_user_permissions` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `user_id` INT(11) NOT NULL,
  `permission_id` INT(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `auth_user_user_permissions_user_id_permission_id_14a6b632_uniq` (`user_id` ASC, `permission_id` ASC) VISIBLE,
  INDEX `auth_user_user_permi_permission_id_1fbb5f2c_fk_auth_perm` (`permission_id` ASC) VISIBLE,
  CONSTRAINT `auth_user_user_permi_permission_id_1fbb5f2c_fk_auth_perm`
    FOREIGN KEY (`permission_id`)
    REFERENCES `healthmanage`.`auth_permission` (`id`),
  CONSTRAINT `auth_user_user_permissions_user_id_a95ead1b_fk_auth_user_id`
    FOREIGN KEY (`user_id`)
    REFERENCES `healthmanage`.`auth_user` (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`django_admin_settings_menu`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`django_admin_settings_menu` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`django_admin_settings_menu` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `path` VARCHAR(255) NOT NULL,
  `depth` INT(10) UNSIGNED NOT NULL,
  `numchild` INT(10) UNSIGNED NOT NULL,
  `name` VARCHAR(255) NOT NULL,
  `position` VARCHAR(255) NOT NULL,
  `link_type` INT(11) NOT NULL,
  `link` VARCHAR(255) NULL DEFAULT NULL,
  `icon` VARCHAR(255) NULL DEFAULT NULL,
  `priority_level` INT(11) NOT NULL,
  `valid` TINYINT(1) NOT NULL,
  `content_type_id` INT(11) NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `path` (`path` ASC) VISIBLE,
  INDEX `django_admin_setting_content_type_id_b94f39c2_fk_django_co` (`content_type_id` ASC) VISIBLE,
  CONSTRAINT `django_admin_setting_content_type_id_b94f39c2_fk_django_co`
    FOREIGN KEY (`content_type_id`)
    REFERENCES `healthmanage`.`django_content_type` (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 84
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`django_admin_settings_options`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`django_admin_settings_options` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`django_admin_settings_options` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `option_name` VARCHAR(255) NOT NULL,
  `option_value` LONGTEXT NOT NULL,
  `valid` TINYINT(1) NOT NULL,
  `create_time` DATETIME(6) NOT NULL,
  `update_time` DATETIME(6) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `option_name` (`option_name` ASC) VISIBLE)
ENGINE = InnoDB
AUTO_INCREMENT = 8
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`healthinfo_agescale`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`healthinfo_agescale` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`healthinfo_agescale` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `sex` VARCHAR(1) NOT NULL,
  `maxv` SMALLINT(6) NOT NULL,
  `score` SMALLINT(6) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `healthinfo_agescale_sex_maxv_b8f24470_uniq` (`sex` ASC, `maxv` ASC) VISIBLE)
ENGINE = InnoDB
AUTO_INCREMENT = 79
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`healthinfo_bcholesterin`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`healthinfo_bcholesterin` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`healthinfo_bcholesterin` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `measuretime` DATETIME(6) NOT NULL,
  `TC` DECIMAL(4,2) NOT NULL,
  `LDL` DECIMAL(4,2) NOT NULL,
  `HDL` DECIMAL(4,2) NOT NULL,
  `TG` DECIMAL(4,2) NOT NULL,
  `user_id` INT(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `measuretime` (`measuretime` ASC) VISIBLE,
  UNIQUE INDEX `healthinfo_bcholesterin_user_id_measuretime_7234b7d6_uniq` (`user_id` ASC, `measuretime` ASC) VISIBLE,
  CONSTRAINT `healthinfo_bcholesterin_user_id_11c84569_fk_auth_user_id`
    FOREIGN KEY (`user_id`)
    REFERENCES `healthmanage`.`auth_user` (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 5161
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`healthinfo_bloodpressure`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`healthinfo_bloodpressure` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`healthinfo_bloodpressure` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `measuretime` DATETIME(6) NOT NULL,
  `DBP` SMALLINT(6) NOT NULL,
  `SBP` SMALLINT(6) NOT NULL,
  `HR` SMALLINT(6) NOT NULL,
  `user_id` INT(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `measuretime` (`measuretime` ASC) VISIBLE,
  UNIQUE INDEX `healthinfo_bloodpressure_user_id_measuretime_4b621c9b_uniq` (`user_id` ASC, `measuretime` ASC) VISIBLE,
  CONSTRAINT `healthinfo_bloodpressure_user_id_7bbb707c_fk_auth_user_id`
    FOREIGN KEY (`user_id`)
    REFERENCES `healthmanage`.`auth_user` (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 5161
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`healthinfo_bloodpressurescale`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`healthinfo_bloodpressurescale` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`healthinfo_bloodpressurescale` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `sex` VARCHAR(1) NOT NULL,
  `maxv` SMALLINT(6) NOT NULL,
  `score` SMALLINT(6) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `healthinfo_bloodpressurescale_sex_maxv_a3c38617_uniq` (`sex` ASC, `maxv` ASC) VISIBLE)
ENGINE = InnoDB
AUTO_INCREMENT = 37
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`healthinfo_indicator`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`healthinfo_indicator` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`healthinfo_indicator` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(30) NOT NULL,
  `parent_id` INT(11) NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `name` (`name` ASC) VISIBLE,
  INDEX `healthinfo_indicator_parent_id_3152a17d_fk_healthinf` (`parent_id` ASC) VISIBLE,
  CONSTRAINT `healthinfo_indicator_parent_id_3152a17d_fk_healthinf`
    FOREIGN KEY (`parent_id`)
    REFERENCES `healthmanage`.`healthinfo_indicator` (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 58
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`healthinfo_bmiscale`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`healthinfo_bmiscale` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`healthinfo_bmiscale` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `bmi` DECIMAL(4,2) NOT NULL,
  `wtype_id` INT(11) NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `healthinfo_bmiscale_wtype_id_bb6b92ae_fk_healthinfo_indicator_id` (`wtype_id` ASC) VISIBLE,
  CONSTRAINT `healthinfo_bmiscale_wtype_id_bb6b92ae_fk_healthinfo_indicator_id`
    FOREIGN KEY (`wtype_id`)
    REFERENCES `healthmanage`.`healthinfo_indicator` (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 13
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`healthinfo_bodyinfo`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`healthinfo_bodyinfo` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`healthinfo_bodyinfo` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `measuretime` DATETIME(6) NOT NULL,
  `height` DECIMAL(5,2) NOT NULL,
  `weight` DECIMAL(5,2) NOT NULL,
  `waist` DECIMAL(4,2) NOT NULL,
  `user_id` INT(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `measuretime` (`measuretime` ASC) VISIBLE,
  UNIQUE INDEX `healthinfo_bodyinfo_user_id_measuretime_b2b05b69_uniq` (`user_id` ASC, `measuretime` ASC) VISIBLE,
  CONSTRAINT `healthinfo_bodyinfo_user_id_5d6eb973_fk_auth_user_id`
    FOREIGN KEY (`user_id`)
    REFERENCES `healthmanage`.`auth_user` (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 5175
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`healthinfo_commonriskscale`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`healthinfo_commonriskscale` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`healthinfo_commonriskscale` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `sex` VARCHAR(1) NOT NULL,
  `age` SMALLINT(6) NOT NULL,
  `avgrisk` DECIMAL(3,1) NOT NULL,
  `minrisk` DECIMAL(3,1) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `healthinfo_commonriskscale_sex_age_7809cd0a_uniq` (`sex` ASC, `age` ASC) VISIBLE)
ENGINE = InnoDB
AUTO_INCREMENT = 21
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`healthinfo_diabetesscale`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`healthinfo_diabetesscale` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`healthinfo_diabetesscale` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `sex` VARCHAR(1) NOT NULL,
  `diabetes` TINYINT(1) NOT NULL,
  `score` SMALLINT(6) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `healthinfo_diabetesscale_sex_diabetes_399abc23_uniq` (`sex` ASC, `diabetes` ASC) VISIBLE)
ENGINE = InnoDB
AUTO_INCREMENT = 9
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`healthinfo_healthintervent`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`healthinfo_healthintervent` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`healthinfo_healthintervent` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `intervent` VARCHAR(254) NOT NULL,
  `hmtype_id` INT(11) NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `healthinfo_healthint_hmtype_id_bdd0711d_fk_healthinf` (`hmtype_id` ASC) VISIBLE,
  CONSTRAINT `healthinfo_healthint_hmtype_id_bdd0711d_fk_healthinf`
    FOREIGN KEY (`hmtype_id`)
    REFERENCES `healthmanage`.`healthinfo_indicator` (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 71
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`healthinfo_riskanalyse`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`healthinfo_riskanalyse` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`healthinfo_riskanalyse` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `risk` VARCHAR(254) NOT NULL,
  `hmtype_id` INT(11) NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `healthinfo_riskanaly_hmtype_id_7b737082_fk_healthinf` (`hmtype_id` ASC) VISIBLE,
  CONSTRAINT `healthinfo_riskanaly_hmtype_id_7b737082_fk_healthinf`
    FOREIGN KEY (`hmtype_id`)
    REFERENCES `healthmanage`.`healthinfo_indicator` (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 57
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`healthinfo_riskevaluatscale`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`healthinfo_riskevaluatscale` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`healthinfo_riskevaluatscale` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `sex` VARCHAR(1) NOT NULL,
  `score` SMALLINT(6) NOT NULL,
  `risk` DECIMAL(3,1) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `healthinfo_riskevaluatscale_sex_score_cc57f8db_uniq` (`sex` ASC, `score` ASC) VISIBLE)
ENGINE = InnoDB
AUTO_INCREMENT = 114
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`healthinfo_singleassess`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`healthinfo_singleassess` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`healthinfo_singleassess` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `assesstype` VARCHAR(30) NOT NULL,
  `assessname` VARCHAR(30) NOT NULL,
  `minv` DOUBLE NOT NULL,
  `maxv` DOUBLE NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `healthinfo_singleassess_assesstype_assessname_7c73bf86_uniq` (`assesstype` ASC, `assessname` ASC) VISIBLE)
ENGINE = InnoDB
AUTO_INCREMENT = 15
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`healthinfo_smokediabetesinfo`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`healthinfo_smokediabetesinfo` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`healthinfo_smokediabetesinfo` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `smoke` TINYINT(1) NOT NULL,
  `smokestart` DATE NULL DEFAULT NULL,
  `drink` TINYINT(1) NOT NULL,
  `drinkstart` DATE NULL DEFAULT NULL,
  `diabetes` TINYINT(1) NOT NULL,
  `diabetesstart` DATE NULL DEFAULT NULL,
  `user_id` INT(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `user_id` (`user_id` ASC) VISIBLE,
  INDEX `healthinfo_smokediabetesinfo_smoke_8602e916` (`smoke` ASC) VISIBLE,
  INDEX `healthinfo_smokediabetesinfo_drink_93401318` (`drink` ASC) VISIBLE,
  INDEX `healthinfo_smokediabetesinfo_diabetes_9647a9ae` (`diabetes` ASC) VISIBLE,
  CONSTRAINT `healthinfo_smokediabetesinfo_user_id_9a5c2ef2_fk_auth_user_id`
    FOREIGN KEY (`user_id`)
    REFERENCES `healthmanage`.`auth_user` (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 174
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`healthinfo_smokescale`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`healthinfo_smokescale` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`healthinfo_smokescale` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `sex` VARCHAR(1) NOT NULL,
  `smoke` TINYINT(1) NOT NULL,
  `score` SMALLINT(6) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `healthinfo_smokescale_sex_smoke_c6af26aa_uniq` (`sex` ASC, `smoke` ASC) VISIBLE)
ENGINE = InnoDB
AUTO_INCREMENT = 9
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`healthinfo_tcscale`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`healthinfo_tcscale` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`healthinfo_tcscale` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `sex` VARCHAR(1) NOT NULL,
  `maxv` DECIMAL(4,2) NOT NULL,
  `score` SMALLINT(6) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `healthinfo_tcscale_sex_maxv_6246d789_uniq` (`sex` ASC, `maxv` ASC) VISIBLE)
ENGINE = InnoDB
AUTO_INCREMENT = 13
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`healthinfo_userinfo`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`healthinfo_userinfo` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`healthinfo_userinfo` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `ssn` VARCHAR(18) NULL DEFAULT NULL,
  `birthday` DATE NOT NULL,
  `sex` VARCHAR(1) NOT NULL,
  `phone` VARCHAR(11) NOT NULL,
  `province` VARCHAR(16) NOT NULL,
  `city` VARCHAR(16) NOT NULL,
  `org` VARCHAR(30) NULL DEFAULT NULL,
  `job` VARCHAR(20) NOT NULL,
  `address` VARCHAR(60) NULL DEFAULT NULL,
  `photo` VARCHAR(100) NOT NULL,
  `user_id` INT(11) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `user_id` (`user_id` ASC) VISIBLE,
  INDEX `healthinfo_userinfo_sex_387516e6` (`sex` ASC) VISIBLE,
  INDEX `healthinfo_userinfo_province_a7c1bc2a` (`province` ASC) VISIBLE,
  CONSTRAINT `healthinfo_userinfo_user_id_34c37efc_fk_auth_user_id`
    FOREIGN KEY (`user_id`)
    REFERENCES `healthmanage`.`auth_user` (`id`))
ENGINE = InnoDB
AUTO_INCREMENT = 174
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `healthmanage`.`healthinfo_weightscale`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `healthmanage`.`healthinfo_weightscale` ;
CREATE TABLE IF NOT EXISTS `healthmanage`.`healthinfo_weightscale` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `sex` VARCHAR(1) NOT NULL,
  `maxv` SMALLINT(6) NOT NULL,
  `score` SMALLINT(6) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `healthinfo_weightscale_sex_maxv_7022cc2f_uniq` (`sex` ASC, `maxv` ASC) VISIBLE)
ENGINE = InnoDB
AUTO_INCREMENT = 19
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

4.6.	输入输出界面设计
输入输出界面的设计在用户与应用程序或网站的交互方式中起着至关重要的作用，由于采用B/S模式，为了适应用户不同客户端设备、操作系统和浏览器，同时由于系统的输出需要图表显示，本系统使用了开源的AdminLTE前端框架和百度Echart图表框架，建立统一的输入输出形式。
AdminLTE是一款建立在Bootstrap和JQuery之上的开源的高可定制性、易用性前端模板主题框架，它基于模块化设计，提供了一系列响应式、可重用组件，并内置了仪表盘、日历、锁屏、登录及注册、404错误、500错误等多个模板页面；自适应多种屏幕分辨率，兼容PC端和手机移动端，AdminLTE框架在网页架构与设计上，具有以下特点：
	响应式设计，不但支持PC客户端，还适配手机等移动端； 
	支持多数主流浏览器，包括Safari, IE9+, Chrome, firefox以及Opera；
	通过加强的打印功能使页面支持打印； CSS3语法；
	快速轻量级框架，支持经过W3C验证的HTML5和
	拥有多种主题，自带1000+个Icons，包括Font Awesome, Ion Icons以及Glyphicons；
	开放的开源插件接口，支持多种插件，可以和多种前端库配合开发；
ECharts是Baidu开发的JavaScript开源可视化库，可以流畅的运行在 PC 和移动设备上，兼容IE8/9/10/11，Chrome，Firefox，Safari等多种浏览器，底层依赖矢量图形库 ZRender，提供直观，交互丰富，可高度个性化定制的数据可视化图表，具有以下特点：
	丰富的可视化类型
ECharts 提供了常规的折线图、柱状图、散点图、饼图、K线图，用于统计的盒形图，用于地理数据可视化的地图、热力图、线图，用于关系数据可视化的关系图、treemap、旭日图，多维数据可视化的平行坐标，还有用于 BI 的漏斗图，仪表盘，并且支持图与图之间的混搭。
	多种数据格式无需转换直接使用
ECharts 内置的 dataset 属性支持直接传入包括二维表，key-value 等多种格式的数据源，通过简单的设置 encode 属性可完成数据到图形的映射，更符合可视化的直觉，省去了大部分场景下数据转换的步骤，而且多个组件能够共享一份数据而不用克隆。
	移动端和PC端优化
ECharts通过对移动端交互和PC端优化，实现了通过PC 端鼠标和移动端触屏在坐标系中进行平滑缩放、平移。
	跨平台多增量渲染技术
通过增量渲染技术，配合优化ECharts 能够展现千万级的数据量，能够进行流畅的缩放平移等交互。ECharts 支持以 Canvas、SVG、VML 的形式渲染图表，细粒度的模块化和打包机制减少 ECharts的体积， SVG 渲染减少内存占用，使移动端在较低内存消耗实现图表的渲染， VML实现了低版本 IE兼容，SVG Canvas 实现了大数据量和特效的展现。
	深度的交互式数据探索支持
 “总览为先，缩放过滤按需查看细节”是数据可视化交互的基本需求。ECharts提供了 图例、视觉映射、数据区域缩放、tooltip、数据刷选等交互组件，实现对数据进行多维度数据筛取、视图缩放、展示细节等交互操作。
4.6.1.	输入界面设计
        由于用户所使用体重秤、血压仪等健康设备品牌各异，其的接口无统一标准，因此系统的数据通过网页录入界面提供数据的输入接口，由用户完成数据的输入，其中个人健康用户负责输入自己的健康数据，健康管理用户负责健康标准类数据的输入，管理员用户负责用户信息的管理。
1、用户注册界面的设计
用户注册是用户使用系统的首要步骤，因此在界面上采用了简单直观的设计，只需要输入用户名和密码及确认密码即可注册，其它信息可登陆系统进行修改，并设计了多级数据校验，通过和提示功能实现用户交互的友好性，同时通过红色醒目的信息框，避免用户的错误。

图53：用户注册界面设计

图54：浏览器端错误检查     

图55：服务器端错误校验

2、用户登陆界面的设计
用户登陆的常用界面，在界面设计上采用了简单直观的设计，并设计了多级数据校验，通过和提示功能实现用户交互的友好性，同时通过红色醒目的信息框，避免用户的错误。

图56：用户登陆界面设计

3、用户主界面的布局设计
用户的主界面由四部分构成：标题栏、菜单区、数据区和状态栏构成，在设计上采用了蓝色基调，给人以清新舒适的感觉。

图57：用户主界面设计

标题栏的左侧部分为Logo、系统名称 和左侧菜单区关闭按钮 ，均采用了扁平化设计，菜单区关闭按钮可以关闭左侧的菜单，增大右侧数据区的范围，增加用户查看数据的区域，为用户提供更好的使用体验。标题栏的右侧为用户信息显示按钮  ，显示用户Logo和登陆用户的姓名，单击可以打开用户信息区，如上图右上角，显示用户姓名、用户组信息、注册时间以及修改密码和注销按钮，可以方面的修改用户密码和注销退出系统，密码修改见上图，需输入旧密码和新密码，新旧密码均不可见，为了避免用户输入错误，系统设计了新密码确认，并检测是否一致，即可修改。

图58：密码修改界面设计

菜单区上部显示当前用户的用户名和姓名以及状态，下部显示了该用户所具有权限使用的功能菜单，采用了两级下拉式菜单。
4、用户健康数据和健康标准数据输入界面的设计
为了降低用户使用系统的时间成本，平滑学习曲线，在数据输入界面的设计上保持了一致性，通过单击左侧的菜单可以进入相应类别的数据管理界面，下面以个人基本信息的管理为例进行介绍。
个人基本信息信息管理界面设计如下图所示，包括了查询区、数据列表区、命令执行区、增加按钮、保存按钮，实现数据的增加、删除、修改、查询功能。

图59：数据管理主界面设计

1）新增数据输入界面的设计
通过单击新增按钮，系统进入新增数据窗口，用户可以新增数据，窗口包括新增数据区和操作面板两部分，在数据区结合数据库字段的缺省值设置，达到减少用户的输入和提醒的目的，同时按照数据库结构设计，实现了数据校验，保证了数据。

图60：数据录入界面设计


图61：数据录入校验界面设计

2）数据修改界面的设计
系统在设计上根据数据的不同类型，提供了两种修改方式，一种使在数据列表区中直接修改数据，可以修改多条记录，然后通过保存按钮完成数据的修改；另一种是通过单击数据列表区中数据中蓝色连接，系统进入数据修改窗口，可以当前记录进行修改，数据修改窗口包括新增数据区和操作面板两部分，并根据字段的类型提供了日期选择、下拉选择等输入方式，达到方便用户的输入的目的。

图62：新增基本信息界面


图63：新增身高体重信息日期选择器界面

3）数据查询界面的设计
查询区结合数据列表区实现查询所需的数据的功能，对当前数据集进行进一步过滤，根据用户需求和不同数据集的特点，实现了下拉列表查询、日期钻取查询、模糊查询以及多条件组合查询等。

图64：日期多级钻取查询


图65：下拉列表过滤查询


图66：模糊查询


图67：多条件组合查询

4）数据删除界面的设计
数据删除的设计通过两种方法实现，一种是数据查询区、数据列表区和命令执行区结合实现多条记录删除数据功能，通过对所要删除数据查询过滤，然后选择所需删除的数据，然后执行删除所选数据，最终确认删除数据；另一种是在数据列表区，选择单条记录进入数据编辑区，对当前数据进行删除操作。

图68：多记录数据删除界面设计


图69：数据删除确认界面


图70：单记录数据删除界面

5）外键界面的设计
当数据通过外键关联到其它数据表时，通过 按钮可以直接打开外键关联的表进行数据的录入，实现用户最少的操作完成数据录入的功能。

图71：外键关联数据输入界面设计


图72：树状结构自关联数据界面


图73：健康风险分析外键关联录入界面


图74：健康干预建议外键关联界面

6）其它输入界面设计示例

图75：系统基本设置界面


图76：用户管理界面


图77：用户及权限管理界面


图78：用户组权限管理界面



4.6.2.	输出界面设计
由于用户使用的终端设备各异，系统的输出界面统一采用了浏览器网页浏览的模式进行显示输出，并通过浏览器提供打印输出功能，对于图标系统采用了图像下载转存的方式，用户可以保存图像在其它图像编辑显示软件中使用。
用户输出界面的设计突出了简洁、舒适、突出主题的特点，把页面的布局，内容甚至开发转换为用户愉快和有效的体验，界面设计遵循以下规则：
	少即是多；摆脱无用的元素，并使用清晰的标签和消息。
	保持一致性并仅使用熟悉的元素和模式；在布局，语言和其他设计元素上，提高系统的舒适度和用户使用体验，并帮助用户在短时间内获取信息。
	通过排版提高清晰度；通过图形、表格、文本的排列以最少的内容，突出最大的信息量，便于用户的阅读和理解。
1、用户首页的界面设计
系统在用户的首页设计上，根据用户关注度的不同采用了不同的信息内容显示，方便用户的使用体验，对于个人用户关注的是个人的健康信息，因此通过图表显示吸烟、饮酒、身高、体重、血压、血脂以及糖尿病史等个人的健康信息；而对于健康管理用户关注的是群体信息，因此以中国地图结合用户分布，显示目前健康用户的分布图。

图79：个人用户首页界面设计


图80：健康管理用户首页界面设计

2、健康评估输出界面设计
健康评估的过程实际是用户录入健康信息，系统调用健康分析模块，通过健康评价标准数据进行健康分析，获得评估结果，根据评估结果给出健康干预策略。但用户并不关心这个过程，因此在健康评估输出界面设计上，针对用户的关注的个人健康信息和健康管理指导建议显示在同一输出页面上，采用了显示元素最小化和信息最大化原则，按照文不如表、表不如图的原则，整个输出页面分成了健康数据和健康管理建议两大部分，上部以图表展示健康数据，将用户的基础数据利用图示化显示，下部显示健康分析结果和健康干预建议，使用户能够对照自己的健康数据，查看分析结果，页面清晰明确。
1）日常健康评估界面的设计
日常健康评估是针对个人的吸烟、饮酒、糖尿病患病情况进行分析评估，并通过健康分析，并提出健康干预建议。
流行病学调查表明，吸烟是慢性支气管炎、肺气肿、慢性气道阻塞、肺癌、心、脑血管疾病的主要危险因素，而长期大量饮酒会导致心血管系统受损、损害人的消化系统，糖尿病也会对肾脏、心脑血管产生危害，引起多种并发症，因此在日常健康评估中系统通过仪表盘形式显示吸烟史、饮酒史、糖尿病史，并用不同的颜色显示仪表盘和指针，具有直观和警示的作用，同时用彩色图框和不同的图标显示分析结果，具有醒目特点，并兼有警示的作用。  

图81：日常健康评估界面设计

2）体重健康评估界面的设计
体重健康评估是针对个人日常体重、腰围的动态变化情况进行跟踪和分析评估，近年来研究发现，超重肥胖会引发多种疾病，随着各种家用电子体重秤的普及，通过动态跟踪体重变化，通过健康分析，进行健康干预成为可能。
在体重健康评估中系统设计为通过将体重、身高、腰围以及通过后台计算获得的BMI体质指数的动态变化以折线图的形式显示，同时用彩色图框显示最近三次平均体重、体质指数和腰围数值以及该年龄正常的体重和腰围范围，为用户提供可对比参考的数据，以供今后参照，具有简洁、实用的特点，同时在健康管理指导建议中针对以上数据进行详细健康风险分析和健康干预指导建议。

图82：体重健康评估界面设计

3）血压健康评估界面的设计
血压健康评估是针对个人日常收缩压（日常所说的高压）、舒张压（日常所说的低压）和心率的动态变化情况进行跟踪和分析评估，随着我国老龄化的日益加剧，近年来高血压作为慢性病的主要病种，对个人健康的危害日益凸显，因此超前发现、提前控制对与高血压的治疗和控制具有重要的意义，随着各种家用电子血压计的普及，通过动态跟踪血压变化，通过健康分析，进行健康干预将成为高血压控制的重要手段。
在血压健康评估中系统设计为通过将收缩压和舒张压以面积图来显示，通过红色半透明渐变面积图和粉色半透明渐变面积显示收缩压和舒张压的变化波动，同时二者通过相互覆盖标识出的渐变半透明红色条带，把压差的变化也通过图形表现出来，有利于用户直观的发现压差的变化，同时用彩色图框显示最近三次平均收缩压、舒张压和心率值以及正常的收缩压、舒张压和心率值范围，为用户提供可对比的数据，以供参照，具有简洁、实用的特点，同时在健康管理指导建议中针对以上数据进行详细健康风险分析和健康干预指导建议。

图83：血压健康评估界面设计

4）血脂健康评估界面的设计
血脂健康评估是针对个人日常总胆固醇、甘油三酯、低密度胆固醇、高密度胆固醇的动态变化情况进行跟踪和分析评估，高脂血症一直以来动脉粥样硬化，冠心病，胰腺炎等疾病重要危险因素，因此动态监控个人日常血脂变化，对提前发现高脂血症，避免或减少动脉粥样硬化，冠心病，胰腺炎等疾病的发病具有重要意义。
在血脂健康评估中系统设计为通过半透明渐变面积图动态显示总胆固醇、甘油三酯、低密度胆固醇、高密度胆固醇的变化波动，有利于用户直观的发现血脂的变化，同时用彩色图框显示最近三次总胆固醇、甘油三酯、低密度胆固醇、高密度胆固醇的平均值以及正常的总胆固醇、甘油三酯、低密度胆固醇、高密度胆固醇范围，为用户提供可对比参考的数据，具有简洁、实用的特点，同时在健康管理指导建议中针对以上数据进行详细健康风险分析和健康干预指导建议。

图84：血脂健康评估界面设计

5）缺血性心血管病(ICVD)10年发病绝对危险度评估界面的设计
缺血性心血管病(ICVD) 是是由于冠状动脉供氧跟机体的心脏需氧之间失平衡引起疾病，以冠心病和缺血性脑卒中为代表的心脑血管疾病,统称为缺血性心血管病,该类疾病的发病与多种因素有关。
缺血性心血管病(ICVD)10年发病绝对危险度评估通过对年龄、体重、吸烟、性别、血压、血脂、糖尿病等多项因素收集，利用缺血性心血管病10年发病的风险评估模型，分析计算用户10年发病的危险度百分比，对用户避免未来患缺血性心血管病提出健康干预建议，对减少用户患病风险具有重要意义。
系统用彩色图框将用户的缺血性心血管病10年发病绝对危险度百分比、同年龄的缺血性心血管病10年发病平均绝对危险度和同年龄缺血性心血管病10年发病最低绝对危险度对比显示，并用进度条显示其百分比数值，具有简洁、直观的特点，为用户提供可对比的数据，同时在健康管理指导建议中针对以上数据进行详细健康风险分析和健康干预指导建议。

图85：ICVD评估界面设计

6）图表界面的设计
图表界面在设计上主要针对日常用户的操作需求进行开发，分别设计增加了数据的X轴和Y轴缩放工具栏，使用户何以针对特定范围的数据进行分析查看，通过设计鼠标悬浮提示工具显示当前鼠标位置的数据值，通过单击图例可以关闭或打开该列数据图的显示，并为图表显示设计了图表工具栏实现图像保存、数据查看、数据刷新功能。

图86：图表显示界面设计


图87：去除甘油三酯数据修改X轴后显示图

图88：查看数据视图界面

7)人群分布分析界面的设计
在人群分布分析界面的设计上，为了直观的表现分布特征，在设计上采用了地图的模式进行表现，并通过颜色的变化渲染地图表现数据的变化，实现了数据的直观化显示，通过鼠标在不同位置钻取显示数据的具体数值。

图89：吸烟人群分布分析界面


图90：饮酒人群分布分析界面


图91：肥胖人群分布分析界面


图92：糖尿病人群分布分析界面


图93：高血压人群分布分析界面


图94：高脂血人群分布分析界面

8) 健康管理用户不良习惯及慢性病分布分析界面的设计
健康管理用户不良习惯及慢性病分布分析界面的设计中，采用地图和圆环图相结合，通过数据的多级钻取，通过省联动显示，对吸烟、饮酒、糖尿病、高血压、高血脂患者的男女人数进行图示化显示，使数据更加形象，便于理解和分析。

图95：健康管理用户不良习惯及慢性病分布分析界面的设计


4.7.	代码设计
4.7.1.	视图代码
视图是实现健康管理和分析业务逻辑的核心，它负责通过模型类获取数据，根据业务逻辑对数据进行分析计算加工，并将结果传递给模板，下面列举了部分主要视图代码：
1、用户注册视图
      def register(request):   
    if request.user.is_authenticated:  # 不允许重复登录
        return redirect("/healthinfo/") 
    if request.method == 'POST':        
        regist_form = forms.UserRegistForm(request.POST)
        if regist_form.is_valid():
            username = request.POST.get('username')        
            password = request.POST.get('password')     
            password1 = request.POST.get('password1')     
            #username, email=None, password=None, **extra_fields
            if password != password1:
                message = '两次输入的密码不同！'
                return render(request,'healthinfo/register.html',locals())
            else:      
                user = User.objects.create_user(username=username,password=password)                if user:            
                    auth.login(request, user) 
                    return redirect("/healthinfo/")  
                else:
                    message = '用户注册失败，请与管理员联系！'
                    return render(request,'healthinfo/register.html',locals())
    regist_form = forms.UserRegistForm()
    return render(request,'healthinfo/register.html',locals())
2、用户登录视图
def login(request):     
    if request.user.is_authenticated:  # 判断是否重复登录
        return redirect("/healthinfo/") 
    if request.method=='POST':        
        login_form = forms.UserLoginForm(request.POST)
        if login_form.is_valid():
            username=request.POST.get('username','')        
            password=request.POST.get('password','')        
            user = auth.authenticate(username=username, password=password)
            if user and user.is_active:            
                auth.login(request, user)
                return redirect("/healthinfo/")   
            elif not user.is_active:
                message='用户未激活,请与管理员联系！'
            else:
                message='用户不存在或密码错误！'
        else:
            message = login_form.errors  #获取form中定义的校验错误信息
    login_form = forms.UserLoginForm()        
    return render(request,"healthinfo/login.html",locals()) 
3、缺血性心脏病十年发病风险健康评估视图
@login_required
def icvdrisk(request):
    user=request.user
    #平均值的天数
    avgnum=3
    userdata = UserData(user)
    sex = userdata.getsex()
    age = userdata.getage()
    myhealth = HealthRiskAssess()
    assessresult = myhealth.icvdassess(userdata)
    risks=[]
    intervents=[]
    val=''
    if userdata.getsmoke():
        val='吸烟'
        risks.extend(myhealth.getrisks(val))  
        intervents.extend(myhealth.getintervents(val))  
    if userdata.getdrink():
        val='饮酒'
        risks.extend(myhealth.getrisks(val))  
        intervents.extend(myhealth.getintervents(val))   
    if userdata.getdiabetes():
        val='糖尿病'
        risks.extend(myhealth.getrisks(val))  
        intervents.extend(myhealth.getintervents(val))    
    #体重
    assessresult = userdata.getbodyinfoavg(avgnum)
    if assessresult:
        bmiresult = myhealth.bmiassess(assessresult[3])
        assessresult.append(bmiresult)
        if (bmiresult == '体重偏瘦'):
            val='体重消瘦'
            risks = myhealth.getrisks(val)
            intervents = myhealth.getintervents(val)
        elif (bmiresult in ['体重偏胖','I度肥胖','II度肥胖','III度肥胖']):
            val='体重肥胖'
            risks.extend(myhealth.getrisks(val))
            intervents.extend(myhealth.getintervents(val))
    #血压
    assessresult = userdata.getbloodpressureavg(avgnum)
    if assessresult:
        bpresult = myhealth.bloodppressureassess(assessresult)
        if bpresult[0] == '收缩压较高' or bpresult[1] == '舒张压较高':
            val = '高血压' 
            risks.extend(myhealth.getrisks(val))  
            intervents.extend(myhealth.getintervents(val))   
        elif bpresult[0] == '收缩压较低' or bpresult[1] == '舒张压较低':
            val = '低血压' 
            risks.extend(myhealth.getrisks(val))  
            intervents.extend(myhealth.getintervents(val)) 
    #血脂
    assessresult = userdata.getbcholesterinavg(avgnum)
    if assessresult:
        bpresult = myhealth.bcholesterinassess(assessresult)
        if bpresult[0] == '总胆固醇较高':
            val = '高脂血' 
            risks.extend(myhealth.getrisks(val))  
            intervents.extend(myhealth.getintervents(val))   
        elif bpresult[0] == '总胆固醇较低':
            val = '低脂血' 
            risks.extend(myhealth.getrisks(val))  
            intervents.extend(myhealth.getintervents(val))   
    if not val:
        risks =[['您拥有良好的日常习惯和身体条件，这是是身体健康的基础！']]
        intervents=[['建议保持良好的日常习惯，控制饮食，少盐少糖少油，同时加强体育锻炼!']]
    return render(request,'healthinfo/icvdrisk.html', locals())

4、日常健康评估视图
@login_required
def habitassess(request):
    user = request.user
    userdata = UserData(user)
    sex = userdata.getsex()
    age = userdata.getage()
    smokeyear = userdata.getsmokeyears()
    drinkyear = userdata.getdrinkyears()
    diabetesyear = userdata.getdiabetesyears()
    myhealth = HealthRiskAssess()
    risks=[]
    intervents=[]
    val=''
    if userdata.getsmoke():
        val='吸烟'
        risks.extend(myhealth.getrisks(val))  
        intervents.extend(myhealth.getintervents(val))  
    if userdata.getdrink():
        val='饮酒'
        risks.extend(myhealth.getrisks(val))  
        intervents.extend(myhealth.getintervents(val))   
    if userdata.getdiabetes():
        val='糖尿病'
        risks.extend(myhealth.getrisks(val))  
        intervents.extend(myhealth.getintervents(val))    
    if not val:
        risks =[['您日常没有吸烟和饮酒的习惯，也无糖尿病史，拥有良好的日常习惯是身体健康的基础！']]
        intervents=[['建议保持良好的日常习惯，控制饮食，少盐少糖少油，同时加强体育锻炼!']]
    return render(request, 'healthinfo/habitassess.html', locals())
5、血压健康评估
@login_required
def bloodpressureassess(request):
    user = request.user
    #数据的天数
    num = 30
    #平均值的天数
    avgnum = 3
    userdata = UserData(user)
    bpdataset = userdata.getbloodpressure(num)
    assessresult = userdata.getbloodpressureavg(avgnum)
    if assessresult:
        myhealth = HealthRiskAssess()
        bpresult = myhealth.bloodppressureassess(assessresult)
        normaldbp = myhealth.getdbp()
        normalsbp = myhealth.getsbp()
        normalhr = myhealth.gethr()
        risks=[]
        intervents=[]
        val=''
        if bpresult[0] == '收缩压较高' or bpresult[1] == '舒张压较高':
            val = '高血压' 
            risks.extend(myhealth.getrisks(val))  
            intervents.extend(myhealth.getintervents(val))   
        elif bpresult[0] == '收缩压较低' or bpresult[1] == '舒张压较低':
            val = '低血压' 
            risks.extend(myhealth.getrisks(val))  
            intervents.extend(myhealth.getintervents(val)) 
        else:
            risks.extend([['祝贺您，您的血压正常，拥有良好的日常习惯是身体健康的基础！']])
            intervents.extend([['建议保持良好的日常习惯，控制饮食，少盐少糖少油，同时加强体育锻炼']])
        risks.extend(myhealth.getrisks(bpresult[2]))  
        intervents.extend(myhealth.getintervents(bpresult[2])) 
    return render(request, 'healthinfo/bloodpressureassess.html', locals())
6、血脂健康评估
@login_required
def bcholesterinassess(request):
    user = request.user
    #数据的天数
    num = 30
    #平均值的天数
    avgnum=3
    userdata = UserData(user)
    bsdataset = userdata.getbcholesterin(num)
    assessresult = userdata.getbcholesterinavg(avgnum)
    if assessresult:
        myhealth = HealthRiskAssess()
        bpresult = myhealth.bcholesterinassess(assessresult)
        normaltc = myhealth.gettc()
        normalldl = myhealth.getldl()
        normalhdl = myhealth.gethdl()
        normaltg = myhealth.gettg()
        risks=[]
        intervents=[]
        val=''
        if bpresult[0] == '总胆固醇较高':
            val = '高脂血' 
            risks.extend(myhealth.getrisks(val))  
            intervents.extend(myhealth.getintervents(val))   
        elif bpresult[0] == '总胆固醇较低':
            val = '低脂血' 
            risks.extend(myhealth.getrisks(val))  
            intervents.extend(myhealth.getintervents(val))   
        else:
            riskstr=''
            if bpresult[1] == '低密度脂蛋白较低':
                riskstr += '您的'+bpresult[1]+'，注意加强低密度脂蛋白的摄入，'
            if bpresult[2] == '高密度脂蛋白较低':
                riskstr += '您的'+bpresult[2]+'，注意加强高密度脂蛋白的摄入，'
            if bpresult[3] == '甘油三酯较低':
                riskstr += '您的'+bpresult[3]+'，注意加强甘油三酯的摄入，'
            if bpresult[1] == '低密度脂蛋白较高':
                riskstr += '您的'+bpresult[1]+'，注意控制低密度脂蛋白的摄入，'
            if bpresult[2] == '高密度脂蛋白较高':
                riskstr += '您的'+bpresult[2]+'，注意控制高密度脂蛋白的摄入，'
            if bpresult[3] == '甘油三酯较高':
                riskstr += '您的'+bpresult[3]+'，注意控制甘油三酯的摄入，'
            riskstr += '拥有良好的日常习惯是身体健康的基础！'
            risks.extend([[riskstr]])    
            intervents.extend([['建议保持良好的生活习惯，控制饮食，加强体育锻炼！']])
    return render(request, 'healthinfo/bcholesterinassess.html', locals())
7、体重健康评估视图
@login_required
def weightassess(request):
    user = request.user
    #数据的天数
    num = 30
    #平均值的天数
    avgnum=3
    userdata = UserData(user)
    bddataset = userdata.getbodyinfo(num)
    sex = userdata.getsex()
    age = userdata.getage()
    assessresult = userdata.getbodyinfoavg(avgnum)
    myhealth = HealthRiskAssess()
    if assessresult:
        bmiresult = myhealth.bmiassess(assessresult[3])
        assessresult.append(bmiresult)
        risks=[]
        intervents=[]
        val=''
        if (bmiresult == '体重偏瘦'):
            val='体重消瘦'
            risks.extend(myhealth.getrisks(val))
            intervents.extend(myhealth.getintervents(val))
        elif (bmiresult in ['体重偏胖','I度肥胖','II度肥胖','III度肥胖']):
            val='体重肥胖'
            risks.extend(myhealth.getrisks(val))
            intervents.extend(myhealth.getintervents(val))
        else:
            risks.extend([['您的体重非常正常！'],])
            intervents.extend([['建议保持，同时加强体育锻炼']])
        normalweight = myhealth.getnormalweight(assessresult[0])
        normalwaist = myhealth.getnormalwaist(sex, assessresult[0])
return render(request, 'healthinfo/weightassess.html', locals())
8、吸烟人群分布分析视图
@permission_required( 'auth.view_user',  raise_exception=True)
def smokeanalye(request):
    analyse = AnalyseStatistics()
    data = analyse.getsmokecount(sex=None, group='P')
    if data:
        valmax = max([x[1] for x in data])
        dataset = analyse.convertdict(data)
    return render(request, 'healthinfo/smokeanalye.html', locals())
9、肥胖人群分布分析视图
@permission_required('auth.view_user', raise_exception=True)
def fatanalye(request):
    analyse = AnalyseStatistics()
    data = analyse.getfatcount(sex=None, group='P')
    if data:
        valmax = max([x[1] for x in data])
        dataset = analyse.convertdict(data)
    return render(request, 'healthinfo/fatanalye.html', locals())
10、不良习惯及慢性病分布分析视图
@permission_required('auth.view_user', raise_exception=True)
def analye(request):
    user = request.user
    provinces = ['北京', '广东', '上海', '天津', '重庆', '辽宁', '江苏', '湖北', '四川', '陕西', '河北', '山西', '河南', '吉林', '黑龙江', '内蒙古', '山东', '安徽', '浙江', '福建', '湖南', '广西', '江西', '贵州', '云南', '西藏', '海南', '甘肃', '宁夏', '青海', '新疆', '香港', '澳门', '台湾']
    analyse = AnalyseStatistics()
    piedataset={}
    for province in provinces :
        piedataset[province] = [['男', 0, 0, 0, 0, 0], ['女', 0, 0, 0, 0, 0]]
    sex_choice = ('M', 'F')
    for sex in sex_choice:
        counts = analyse.getsmokecount(sex=sex, group='P')
        for count in counts:
            piedataset[count[0]][sex_choice.index(sex)][1] = count[1]
        counts = analyse.getdrinkcount(sex=sex, group='P')
        for count in counts:
            piedataset[count[0]][sex_choice.index(sex)][2] = count[1]
        counts = analyse.getdiabetescount(sex=sex, group='P')
        for count in counts:
            piedataset[count[0]][sex_choice.index(sex)][3] = count[1]
        counts=analyse.gethypertensioncount(sex=sex,group='P')
        for count in counts:
            piedataset[count[0]][sex_choice.index(sex)][4] = count[1]
        counts=analyse.gethyperlipemcount(sex=sex,group='P')
        for count in counts:
            piedataset[count[0]][sex_choice.index(sex)][5] = count[1]
    data = analyse.getusercount(sex=None, group='P')
    if data:
        dataset = analyse.convertdict(data)
        valmax = max([x[1] for x in data])
    return render(request, 'healthinfo/analye.html', locals())
4.7.2.	模型类
模型类是系统中对象到MySQL数据库中数据表的映射的基础，是实现ORM的关键，系统包括UserInfo，BodyInfo，BloodPressure，Bcholesterin，SmokeDiabetesInfo，Bcholesterin个人健康信息模型类和AgeScale，WeightScale，BloodPressureScale，SmokeScale，DiabetesScale，RiskEvaluatScale，CommonRiskScale，TCScale，BMIScale，HealthIntervent，RiskAnalyse，SingleAssess，Indicator健康标准模型类，下面列举了部分类的代码：
1、用户基本信息
class UserInfo(models.Model):
    Userinfo_sex_choice = (
        ('M', '男'),
        ('F', '女'),
    )
    user=models.OneToOneField(User,unique=True,verbose_name='用户名',on_delete=models.CASCADE)
    ssn =  models.CharField(verbose_name='身份证号',max_length=18,null=True) 
    birthday = models.DateField(verbose_name='出生日期')
    sex = models.CharField(verbose_name='性别',default='M',choices=Userinfo_sex_choice,max_length=1,db_index=True)
    phone = models.CharField(verbose_name='电话',max_length=11)
    province = models.CharField(verbose_name='省', max_length=16,default='辽宁',db_index=True)
    city = models.CharField(verbose_name='市', max_length=16,default='盘锦')
    org = models.CharField(verbose_name='单位', max_length=30,null=True,blank=True,default=None)
    job = models.CharField(verbose_name='职位', max_length=20,default='工人')
    address = models.CharField(verbose_name='地址', max_length=60,null=True,default=None)
    photo = models.ImageField(verbose_name='照片',blank=True,default=None)

    def __str__(self):
        return '%s--%s' % (self.user, self.ssn)
    
    class Meta:
        verbose_name = '基本信息'
        verbose_name_plural = "基本信息"
2、吸烟糖尿病信息
class SmokeDiabetesInfo(models.Model):
    user=models.OneToOneField(User,unique=True,verbose_name='用户名',on_delete=models.CASCADE)
    smoke= models.BooleanField(verbose_name='吸烟',default=False,db_index=True)
    smokestart = models.DateField(verbose_name='吸烟开始时间',null=True,blank=True,default=None)
    drink= models.BooleanField(verbose_name='饮酒',default=False,db_index=True)
    drinkstart = models.DateField(verbose_name='饮酒开始时间',null=True,blank=True,default=None)
    diabetes=models.BooleanField(verbose_name='糖尿病',default=False,db_index=True)
    diabetesstart = models.DateField(verbose_name='糖尿病患病时间',null=True,blank=True,default=None)

    def __str__(self):
        return '%s:%s--%s' % (self.user, self.smoke,self.diabetes)
    
    class Meta:
        verbose_name = '吸烟糖尿病信息'
        verbose_name_plural = "吸烟糖尿病信息"
3、身高体重信息
class BodyInfo(models.Model):
    user=models.ForeignKey(User,verbose_name='用户',on_delete=models.CASCADE)
    measuretime = models.DateTimeField(verbose_name='测量时间',unique=True)
    height =  models.DecimalField(verbose_name=('身高(cm)'),max_digits=5,decimal_places=2) 
    weight =  models.DecimalField(verbose_name=('体重(kg)'),max_digits=5,decimal_places=2) 
    waist =  models.DecimalField(verbose_name=('腰围(cm)'),max_digits=4,decimal_places=2) 
    def __str__(self):
        return '%s:%s-%s' % (self.user, self.height,self.weight)

    class Meta:
        unique_together = ('user', 'measuretime')
        ordering = ['user', '-measuretime']
        verbose_name = '身高体重信息'
        verbose_name_plural = "身高体重信息"
4、血压信息
class BloodPressure(models.Model):
    user=models.ForeignKey(User,verbose_name='用户',on_delete=models.CASCADE)
    measuretime = models.DateTimeField(verbose_name='测量时间',unique=True)
    DBP =  models.SmallIntegerField(verbose_name='舒张压(mmHg)') 
    SBP =  models.SmallIntegerField(verbose_name='收缩压(mmHg)') 
    HR =  models.SmallIntegerField(verbose_name='心率') 
    def __str__(self):
        return '%s:%s-%s' % (self.user, self.DBP,self.SBP)

    class Meta:
        unique_together = ('user', 'measuretime')
        ordering = ['user', '-measuretime']
        verbose_name = '血压信息'
        verbose_name_plural = "血压信息"
5、血脂信息
class Bcholesterin(models.Model):
    user=models.ForeignKey(User,verbose_name='用户',on_delete=models.CASCADE)
    measuretime = models.DateTimeField(verbose_name='测量时间',unique=True)
    TC =  models.DecimalField(verbose_name='总胆固醇(mmol/L)',max_digits=4,decimal_places=2) 
    LDL =  models.DecimalField(verbose_name='低密度脂蛋白(mmol/L)',max_digits=4,decimal_places=2) 
    HDL =  models.DecimalField(verbose_name='高密度胆固醇(mmol/L)',max_digits=4,decimal_places=2) 
    TG =  models.DecimalField(verbose_name='甘油三酯(mmol/L)',max_digits=4,decimal_places=2) 
    
    def __str__(self):
        return '%s:%s-%s' % (self.user, self.TC,self.TG)
    
    class Meta:
        ordering = ['user', '-measuretime']  #排序
        unique_together = ('user', 'measuretime') # 联合唯一索引
        verbose_name = '血脂信息'
        verbose_name_plural = "血脂信息"
6、健康指标分类
class Indicator(models.Model):
    name = models.CharField('指标名称', max_length=30, unique=True)
    parent = models.ForeignKey('self', verbose_name='上级分类', null=True, blank=True,on_delete=models.CASCADE, related_name='parents')

    class Meta:
        #db_table = 'health_Indicator'
        ordering = ['parent_id','name'] 
        verbose_name = verbose_name_plural = '健康指标分类'
    def __str__(self):
        return '%s' % (self.name)
7、ICVD血压评估标准
class BloodPressureScale(models.Model):
    sex_choice = (
        ('M', '男'),
        ('F', '女'),
    )
    sex = models.CharField(verbose_name='性别',default='M',choices=sex_choice,max_length=1)
    maxv =  models.SmallIntegerField(verbose_name='收缩压最大值') 
    score =  models.SmallIntegerField(verbose_name='分数') 
    def __str__(self):
        return '%s-%s:%s' % (self.sex, self.score, self.maxv)

    class Meta:
        ordering = ['sex', 'maxv']
        unique_together = ('sex', 'maxv')
        verbose_name = 'ICVD血压评估标准'
        verbose_name_plural = "ICVD血压评估标准"
8、健康风险分析
class RiskAnalyse(models.Model):
    hmtype =models.ForeignKey(Indicator, verbose_name='风险类别', on_delete=models.CASCADE)
    risk =  models.CharField(verbose_name='风险',max_length=254) 

    def __str__(self):
        return '%s' % (self.hmtype)
    class Meta:
        verbose_name = verbose_name_plural = "健康风险分析"
4.7.3.	健康管理分析类代码
健康管理分析类是系统业务逻辑的主要实现代码，包括了UserData、HealthRiskAssess、AnalyseStatistics三个类，其具体实现如下：
1、UserData类
该类实现了个人健康数据的封装，并提供健康数据的获取接口。
class UserData(object):
    def __init__(self,user):
        self.user=user
        self.userinfo = UserInfo.objects.filter(user=user).first()
        self.smokediabetes = SmokeDiabetesInfo.objects.filter(user=user).first()
        self.bodyinfo = BodyInfo.objects.filter(user=user).order_by('-measuretime')
        self.bloodpressure = BloodPressure.objects.filter(user=user).order_by('-measuretime')
        self.bcholesterin = Bcholesterin.objects.filter(user=user).order_by('-measuretime')
    # 获取用户
    # 返回值：用户-queryset类型
    def getuser(self):
        return self.user
    #获取用户id
    def getuserid(self):
        return self.user.pk
    #获取用户姓名
    def getusername(self):
        return self.user.lastname+self.user.firstname

    #获取当前用户性别,
    # 返回值：男性-'M'，女性-'F'，当无userinfo数据时，返回None
    def getsex(self):
        if self.userinfo:
            return self.userinfo.sex
        else:
            return None
    # 获取当前用户年龄
    # 返回值：年龄(int)，当无userinfo数据时，返回None
    def getage(self):
        if self.userinfo:
            return datetime.date.today().year - self.userinfo.birthday.year
        else:
            return None
    # 是否吸烟
    # 返回值；True/False，当无smokediabetes数据时，返回None
    def getsmoke(self):
        if self.smokediabetes:
            return self.smokediabetes.smoke
        else:
            return None
    # 吸烟年限
    # 返回值：无smokediabetes数据-None,不吸烟-0，吸烟-吸烟时间(年)
    def getsmokeyears(self):
        if self.smokediabetes:
            if self.smokediabetes.smoke:
                return datetime.date.today().year - self.smokediabetes.smokestart.year
            else:
                return 0
        else:
            return None        
    # 是否饮酒
    # 返回值；True/False，当无smokediabetes数据时，返回None
    def getdrink(self):
        if self.smokediabetes:
            return self.smokediabetes.drink
        else:
            return None
    # 返回饮酒年限
    # 返回值：无smokediabetes数据-None,不饮酒-0，饮酒-饮酒时间(年)
    def getdrinkyears(self):
        if self.smokediabetes:
            if self.smokediabetes.drink:
                return datetime.date.today().year - self.smokediabetes.drinkstart.year
            else:
                return 0
        else:
            return None
    # 返回是否糖尿病患者
    # 返回值；True/False，当无smokediabetes数据时，返回None
    def getdiabetes(self):
        if self.smokediabetes:        
            return self.smokediabetes.diabetes
        else:
            return None            
    # 返回糖尿病患病年限
    # 返回值：无smokediabetes数据-None,无糖尿病-0，糖尿病-糖尿病时间(年)
    def getdiabetesyears(self):
        if self.smokediabetes:
            if self.smokediabetes.diabetes:
                return datetime.date.today().year - self.smokediabetes.diabetesstart.year
            else:
                return 0
        else:
            return None
    # 获取最后num次的身高体重
    # 参数：num为统计次数
    # 返回值：二维列表[[统计时间],[身高],[体重],[腰围],[BMI]]
    def getbodyinfo(self, num):
        if self.bodyinfo:        
            #取当前用户最后num天的身高、体重、腰围的平均值（如果每天多次测量取平均值）
            #第一行按measuretime的年月日分组
            #第二行按上行的分组计算身高、体重、腰围的平均值，
            #第三行身高、体重、腰围平均值为列表，并利用切片取前最后num天的值 
            avglist = self.bodyinfo.annotate(days=TruncDay('measuretime')).values('days').annotate(heightavg=Avg('height'),weightavg=Avg('weight'),waistavg=Avg('waist')).values('days', 'heightavg', 'weightavg', 'waistavg')[:num]
            #求平均值,日期从前向后，反向迭代取出列表
            dataset=[[m.strftime('%Y-%m-%d') for m in reversed(avglist.values_list('days', flat=True))]]
            dataset.append([float(value) for value in reversed(avglist.values_list('height', flat=True))])
            dataset.append([float(value) for value in reversed(avglist.values_list('weight', flat=True))])
            dataset.append([float(value) for value in reversed(avglist.values_list('waist', flat=True))])
            dataset.append([round(w * 10000 / h / h, 2) for w, h in zip(dataset[2], dataset[1])])       
            return dataset
        else:
            return None        
    # 获取最后num次的血压
    # 参数：num为统计次数
    # 返回值：二维列表[[统计时间],[收缩压],[舒张压],[心率]]
    def getbloodpressure(self, num):
        if self.bloodpressure:        
            avglist = self.bloodpressure.annotate(days=TruncDay('measuretime')).values('days').annotate(DBPavg=Avg('DBP'),SBPavg=Avg('SBP'),HRavg=Avg('HR')).values_list('days', 'DBPavg', 'SBPavg', 'HRavg')[:num]
            dataset=[[m.strftime('%Y-%m-%d') for m in reversed(avglist.values_list('days', flat=True))]]
            dataset.append([float(value) for value in reversed(avglist.values_list('DBPavg', flat=True))])
            dataset.append([float(value) for value in reversed(avglist.values_list('SBPavg', flat=True))])
            dataset.append([float(value) for value in reversed(avglist.values_list('HRavg', flat=True))])     
            return dataset
        else:
            return None       
    # 获取最后num次的血脂
    # 参数：num为统计次数
    # 返回值：二维列表[[统计时间],[总胆固醇],[低密度],[高密度],[甘油三酯]]
    def getbcholesterin(self, num):
        if self.bcholesterin: 
            avglist = self.bcholesterin.annotate(days=TruncDay('measuretime')).values('days').annotate(TCavg=Avg('TC'),LDLavg=Avg('LDL'),HDLavg=Avg('HDL'),TGavg=Avg('TG')).values_list('days', 'TCavg', 'LDLavg',  'HDLavg', 'TGavg')[:num]
            dataset=[[m.strftime('%Y-%m-%d') for m in reversed(avglist.values_list('days', flat=True))]]
            dataset.append([float(value) for value in reversed(avglist.values_list('TCavg', flat=True))])
            dataset.append([float(value) for value in reversed(avglist.values_list('LDLavg', flat=True))])
            dataset.append([float(value) for value in reversed(avglist.values_list('HDLavg', flat=True))])     
            dataset.append([float(value) for value in reversed(avglist.values_list('TGavg', flat=True))])
            return dataset
        else:
            return None  
    # 获取最后num次的平均身高体重
    # 参数：num为统计次数
    # 返回值：一维列表[平均身高,平均体重,平均腰围,平均BMI]
    def getbodyinfoavg(self, num):
        if self.bodyinfo:        
            avglist = self.bodyinfo.annotate(days=TruncDay('measuretime')).values('days').annotate(heightavg=Avg('height'),weightavg=Avg('weight'),waistavg=Avg('waist')).values_list('heightavg', 'weightavg', 'waistavg')[:num]
            #求平均值
            avglist = np.array(avglist).mean(axis=0)
            height = round(float(avglist[0]), 2)          
            weight = round(float(avglist[1]), 2)
            waist = round(float(avglist[2]), 2)
            bmi=round(weight * 10000 / height / height, 2)
            return [height,weight,waist,bmi]
        else:
            return None        
    # 获取最后num次的平均血压
    # 参数：num为统计次数，
    # 返回值：一维列表[平均收缩压,平均舒张压,平均心率]
    def getbloodpressureavg(self, num):
        if self.bloodpressure:        
            avglist = self.bloodpressure.annotate(days=TruncDay('measuretime')).values('days').annotate(DBPavg=Avg('DBP'),SBPavg=Avg('SBP'),HRavg=Avg('HR')).values_list('DBPavg','SBPavg','HRavg')[:num]
            avglist = np.array(avglist).mean(axis=0)
            DBP = int(float(avglist[0]))          
            SBP = int(float(avglist[1]))
            HR = int(float(avglist[2]))
            return [DBP,SBP,HR]
        else:
            return None   
        
     # 获取最后num次的平均血脂
     # 参数：num为统计次数，
     # 返回值：一维列表[平均总胆固醇,平均低密度,平均高密度,平均甘油三酯]
    def getbcholesterinavg(self, num):
        if self.bcholesterin: 
            avglist = self.bcholesterin.annotate(days=TruncDay('measuretime')).values('days')\
                .annotate(TCavg=Avg('TC'),LDLavg=Avg('LDL'),HDLavg=Avg('HDL'),TGavg=Avg('TG'))\
                .values_list('TCavg','LDLavg','HDLavg','TGavg')[:num]
            avglist = np.array(avglist).mean(axis=0)
            TC = round(float(avglist[0]), 2)
            LDL = round(float(avglist[1]), 2)          
            HDL = round(float(avglist[2]), 2)
            TG = round(float(avglist[3]), 2)
            return [TC,LDL,HDL,TG]
        else:
            return None   
    #返回用户是否为肥胖
    def getfat(self):
        healthrisk = HealthRiskAssess()
        avg=self.getbodyinfoavg(3)
        if avg:
            result=healthrisk.bmiassess(avg[3])
            if (result in ['体重偏胖','I度肥胖','II度肥胖','III度肥胖']):
                return True
            else:
                return False
        else:
            return None
    #返回用户是否为高血压
    def gethypertension(self):
        healthrisk = HealthRiskAssess()
        avg=self.getbloodpressureavg(3)
        if avg:
            result=healthrisk.bloodppressureassess(avg)
            if result[0] == '收缩压较高' or result[1] == '舒张压较高':
                return True
            else:
                return False
        else:
            return None
    #返回用户是否为高脂血
    def gethyperlipem(self):
        healthrisk = HealthRiskAssess()
        avg=self.getbcholesterinavg(3)
        if avg:
            result = healthrisk.bcholesterinassess(avg)
            if result[0] == '总胆固醇较高':
                return True
            else:
                return False
        else:
            return None
2、HealthRiskAssess类
该类是健康评估类，是对日常健康、体重、血压、血脂、缺血性心脏病十年发病风险的健康分析、健康干预的实现。
#健康风险评估类 
class HealthRiskAssess(object):
    def __init__(self):
        #初始化bmi评估标准
        bmiscale = np.array(BMIScale.objects.all().values_list('bmi', 'wtype'))
        self.bmiscale=bmiscale[np.lexsort(bmiscale.T)].transpose()
        self.weighttypes={}
        indicator= Indicator.objects.filter(name='BMI评价').first()    
        for ind in Indicator.objects.filter(parent=indicator).values_list('id','name'):
            self.weighttypes[ind[0]]= ind[1]        
        #初始化单项评估标准
        self.singlescale = np.array(SingleAssess.objects.all().values_list('assesstype', 'assessname', 'minv', 'maxv'))
        #初始化icvd评估标准
        self.icvdscale = {}
        for sex in ('M','F'):
            agescale =  np.array(AgeScale.objects.filter(sex=sex).values_list('maxv','score'))
            weightscale = np.array(WeightScale.objects.filter(sex=sex).values_list('maxv','score'))
            bloodpPressurescale =  np.array(BloodPressureScale.objects.filter(sex=sex).values_list('maxv','score'))
            tcscale =  np.array(TCScale.objects.filter(sex=sex).values_list('maxv','score'))
            smokescale =  np.array(SmokeScale.objects.filter(sex=sex).values_list('smoke','score'))
            diabetesscale =  np.array(DiabetesScale.objects.filter(sex=sex).values_list('diabetes','score'))
            riskevaluatscale =  np.array(RiskEvaluatScale.objects.filter(sex=sex).values_list('score','risk'))
            commonriskscale =  np.array(CommonRiskScale.objects.filter(sex=sex).values_list('age','avgrisk','minrisk'))
            
            #对评价数组按最后一列排序，并进行转置为[[值],[得分]]形式
            agescale=agescale[np.lexsort(agescale.T)].transpose()
            weightscale=weightscale[np.lexsort(weightscale.T)].transpose()
            bloodpPressurescale=bloodpPressurescale[np.lexsort(bloodpPressurescale.T)].transpose()
            tcscale=tcscale[np.lexsort(tcscale.T)].transpose()    
            smokescale=smokescale[np.lexsort(smokescale.T)].transpose()
            diabetesscale=diabetesscale[np.lexsort(diabetesscale.T)].transpose()
            riskevaluatscale=riskevaluatscale[np.lexsort(riskevaluatscale.T)].transpose()
            commonriskscale=commonriskscale[np.lexsort(commonriskscale.T)].transpose()
            self.icvdscale[sex] = {'agescale': agescale,
                        'weightscale':weightscale,
                        'bloodppressurescale':bloodpPressurescale,
                        'tcscale':tcscale,
                        'smokescale':smokescale,
                        'diabetesscale':diabetesscale,
                        'riskevaluatscale':riskevaluatscale,
                        'commonriskscale': commonriskscale}
    #icvd数值标准评分判定函数
    # 参数：sex-性别，htype-所欲评估的类型,icvdscale字典的key值，val-所欲评估类型的值，
    # 返回结果：评估的得分，如无评估标准数据返回None
    def getvalscale(self, sex, htype, val):
        if sex in self.icvdscale:
            thescale = self.icvdscale[sex]
            if htype in thescale:                       
                return thescale[htype][1][np.searchsorted(thescale[htype][0], val, side='right')]
            else:
                return None
        else:
            return None
    #icvd布尔值标准评分判定函数
    # 参数：sex-性别，htype-所欲评估的类型,icvdscale字典的key值，val-所欲评估类型的值，
    # 返回结果：评估的得分，如无评估标准数据返回None
    def getboolscale(self, sex, htype, val):
        if sex in self.icvdscale:
            thescale = self.icvdscale[sex]
            if htype in thescale:               
                return thescale[htype][1][np.searchsorted(thescale[htype][0], val)]
            else:
                return None
        else:
            return None
    # 体重风险评估
    # 参数：bmival-bmi值，
    # 返回结果：体重评价结果，如体重偏瘦、体重肥胖等，如无评估标准数据返回None
    def bmiassess(self, bmival):
        if bmival:
            if self.bmiscale.size:
                return self.weighttypes[self.bmiscale[1][np.searchsorted(self.bmiscale[0], bmival, side='right')]]
        return None
    # 获取特定身高的标准体重范围
    # 参数：height-身高值
    # 返回结果：该身高的正常体重列表[最小正常体重,最大正常体重]
    def getnormalweight(self, height):
        if height:
            if self.bmiscale.size:
                val = height * height / 10000.0
                return [round(float(self.bmiscale[0][0]) * val, 2), round(float(self.bmiscale[0][1]) * val, 2)]
        return None
    # 获取特定性别和身高的标准腰围范围
    # 参数：sex-性别, height-身高值
    # 返回结果：同性别该身高的正常腰围列表[最小正常腰围,最大正常腰围]
    def getnormalwaist(self, sex, height):
        if sex=='M':
            val = 0.47
        else:
            val = 0.37
        return [round(height*val*0.95,2),round(height*val*1.05,2)]
    # 获取收缩压正常范围
    # 返回结果：收缩压正常范围列表[最大值,最小值]，如无评估标准数据返回None
    def getdbp(self):
        for assessname in self.singlescale:
            if assessname[1] == '收缩压':
                return [int(float(assessname[2])),int(float(assessname[3]))]
        return None
    # 获取舒张压正常范围
    # 返回结果：舒张压正常范围列表[最大值,最小值]，如无评估标准数据返回None
    def getsbp(self):
        for assessname in self.singlescale:
            if assessname[1] == '舒张压':
                return [int(float(assessname[2])),int(float(assessname[3]))]
        return None
    # 获取心率正常范围
    # 返回结果：心率正常范围列表[最大值,最小值]，如无评估标准数据返回None
    def gethr(self):
        for assessname in self.singlescale:
            if assessname[1] == '心率':
                return [int(float(assessname[2])),int(float(assessname[3]))]
        return None
    # 血压风险评估
    # 参数：pbval-血压值列表[收缩压, 舒张压，心率]
    # 返回结果： 血压评价结果列表，如无评估标准数据返回None
    def bloodppressureassess(self, val):
        dbp=self.getdbp()
        sbp=self.getsbp()
        hr=self.gethr()
        result = []
        if val and dbp and sbp and hr:
            if val[0]<dbp[0]:
                result.append('收缩压较低')
            elif val[0]>dbp[1]:
                result.append('收缩压较高')
            else:
                result.append('收缩压正常')
            if val[1]<sbp[0]:
                result.append('低舒张较低')
            elif val[1]>sbp[1]:
                result.append('高舒张压')
            else:
                result.append('舒张压正常')
            if val[2]<hr[0]:
                result.append('心动过缓')
            elif val[2]>hr[1]:
                result.append('心动过速')
            else:
                result.append('心率正常')
            return result
        return None
    # 获取总胆固醇正常范围
    # 返回结果：总胆固醇正常范围列表[最大值,最小值]，如无评估标准数据返回None
    def gettc(self):
        for assessname in self.singlescale:
            if assessname[1] == '总胆固醇':
                return [round(float(assessname[2]),2),round(float(assessname[3]),2)]
        return None
    # 获取低密度脂蛋白正常范围
    # 返回结果：低密度脂蛋白正常范围列表[最大值,最小值]，如无评估标准数据返回None
    def getldl(self):
        for assessname in self.singlescale:
            if assessname[1] == '低密度':
                return [round(float(assessname[2]),2),round(float(assessname[3]),2)]
        return None
        
    # 获取高密度脂蛋白正常范围
    # 返回结果：高密度脂蛋白正常范围列表[最大值,最小值]，如无评估标准数据返回None
    def gethdl(self):
        for assessname in self.singlescale:
            if assessname[1] == '高密度':
                return [round(float(assessname[2]),2),round(float(assessname[3]),2)]
        return None
        
    # 获取甘油三酯正常范围
    # 返回结果：甘油三酯正常范围列表[最大值,最小值]，如无评估标准数据返回None
    def gettg(self):
        for assessname in self.singlescale:
            if assessname[1] == '甘油三酯':
                return [round(float(assessname[2]),2),round(float(assessname[3]),2)]
        return None
        # 血压风险评估
    # 参数：pbval-血压值列表[收缩压, 舒张压，心率]
    # 返回结果： 血压评价结果列表，如无评估标准数据返回None
    def bcholesterinassess(self, val):
        tc=self.gettc()
        ldl=self.getldl()
        hdl = self.gethdl()
        tg=self.gettg()
        result = []
        if val and tc and ldl and hdl and tg:
            if val[0]<tc[0]:
                result.append('总胆固醇较低')
            elif val[0]>tc[1]:
                result.append('总胆固醇较高')
            else:
                result.append('总胆固醇正常')
            if val[1]<ldl[0]:
                result.append('低密度脂蛋白较低')
            elif val[1]>ldl[1]:
                result.append('低密度脂蛋白较高')
            else:
                result.append('低密度脂蛋白正常')
            if val[2]<hdl[0]:
                result.append('高密度脂蛋白较低')
            elif val[2]>hdl[1]:
                result.append('高密度脂蛋白较高')
            else:
                result.append('高密度脂蛋白正常')
            if val[3]<tg[0]:
                result.append('甘油三酯较低')
            elif val[3]>tg[1]:
                result.append('甘油三酯较高')
            else:
                result.append('甘油三酯正常')
            return result
        else:
            return None  
    # 返回当前得分的icvd十年发病风险百分比和同龄同性别icvd十年发病平均风险及最小风险
    # 参数：sex-性别, age-年龄, val-icvd评估得分
    # 返回结果：icvd十年发病风险百分比列表[评估人icvd十年发病风险百分比,同龄同性别icvd十年发病平均风险,同龄同性别icvd十年发病最小风险]
    def geticvd(self, sex, age, val):
        if sex in self.icvdscale:
            thescale = self.icvdscale[sex]
            if 'riskevaluatscale' in thescale:               
                myrisk = thescale['riskevaluatscale'][1][np.searchsorted(thescale['riskevaluatscale'][0], val)]
                if 'commonriskscale' in thescale:
                    avgrisk = thescale['commonriskscale'][1][np.searchsorted(thescale['commonriskscale'][0], age)]
                    minrisk = thescale['commonriskscale'][2][np.searchsorted(thescale['commonriskscale'][0], age)]
                    return [myrisk, avgrisk, minrisk]
                else:
                    None
            else:
                return None
        return None
    # 缺血性心血管病icvd十年发病风险评估
    # 参数： userdata-用户的基础数据   
    # 返回结果：用户的得分                 
    def icvdassess(self,userdata):
        #总分赋初值0
        tatol = 0  
        #计算最近3天的平均值
        daynum=3  
        #计算年龄       
        age = userdata.getage()
        sex = userdata.getsex()
        if (age is not None) and (sex is not None):
            #年龄分值计算
            score = self.getvalscale(sex=sex, htype='agescale', val=age)
            tatol += score
            #吸烟评分
            smoke=userdata.getsmoke()    
            if smoke is not None:
                score = self.getboolscale(sex=sex, htype='smokescale', val=smoke)
                tatol += score
            else:
                return None
            #糖尿病评分
            diabetes=userdata.getdiabetes() 
            if diabetes is not None:
                score = self.getboolscale(sex=sex, htype='diabetesscale', val=diabetes)
                tatol += score
            else:
                return None
            #BMI分值计算,计算最近身高、体重、腰围平均值，计算平均值BMI
            bodyinfoavg=userdata.getbodyinfoavg(num=daynum)
            bmi = bodyinfoavg[1] * 10000 / bodyinfoavg[0] / bodyinfoavg[0]
            #返回BMI的分值
            score = self.getvalscale(sex=sex, htype='weightscale', val=bmi)
            if score is not None:
                tatol += score
            else:
                return None
            #血压分值计算，计算最近三天血压平均值
            bloodpressureavg = userdata.getbloodpressureavg(num=daynum)
            #返回血压的分值
            score = self.getvalscale(sex=sex, htype='bloodppressurescale', val=bloodpressureavg[0])
            if score is not None:
                tatol += score
            else:
                return None
            #血脂分值计算，计算最近三天血脂平均值
            bcholesterinavg = userdata.getbcholesterinavg(num=daynum)
            #返回血脂的分值
            score = self.getvalscale(sex=sex, htype='tcscale', val=bcholesterinavg[0])
            if score is not None:
                tatol += score
            else:
                return None
            return self.geticvd(sex, age, tatol)
    # 获取健康风险分析结果
    # 参数： hmtypename-风险类型   
    # 返回结果：风险分析结果列表  
    def getrisks(self,hmtypename):  
        hmtype=Indicator.objects.filter(name=hmtypename).first()
        risks= np.array(RiskAnalyse.objects.filter(hmtype=hmtype).values_list('risk'))
        return risks
    # 获取健康风险干预建议结果
    # 参数： hmtypename-风险类型   
    # 返回结果：风险干预建议结果列表 
    def getintervents(self,hmtypename): 
        hmtype=Indicator.objects.filter(name=hmtypename).first()
        intervents= np.array(HealthIntervent.objects.filter(hmtype=hmtype).values_list('intervent'))
        return intervents
3、AnalyseStatistics类
该类是健康分析类，实现了按地区、性别对吸烟、饮酒、不良健康习惯、肥胖症、高血压、高血脂等人群分布进行健康分析。
class AnalyseStatistics(object):
    def __init__(self):
        pass
    #将列表转换为echart地图使用的字典
    #参数：列表[[data[0],data[1]]]
    #返回值：字典[{'name':data[0],'value':data[1]}]
    def convertdict(self, data):
        title = ['name', 'value']
        dataset=[]
        for d in data:
            if d[0]:
                dataset.append(dict(zip(title, d)))
        return dataset
    #统计用户人数
    #参数: sex-按性别统计，None：全部，M：男性，F:女性
    #      group-分组，None：不分组，C:按城市分组，P：按省分组
    def getusercount(self,sex=None,group=None):
        if sex is None:
            #所有吸烟的用户
            if group == 'P':
                #按省分组统计吸烟用户数量
                num = User.objects.all().values('userinfo__province').annotate(num=Count('userinfo__province')).values_list('userinfo__province','num')
            elif group == 'C':
                #按市分组统计吸烟用户数量
                num = User.objects.all().values('userinfo__city').annotate(num=Count('userinfo__city')).values_list('userinfo__city','num')
            else:
                #统计吸烟用户总数
                num = User.objects.all().count()
        else:
            if group == 'P':
                #按省分组统计特定性别吸烟用户数量
                num  = User.objects.all().values('userinfo__province','userinfo__sex').filter(userinfo__sex=sex).annotate(num=Count('userinfo__province')).values_list('userinfo__province','num')
            elif group == 'C':
                #按市分组统计特定性别吸烟用户数量
                num  = User.objects.all().values('userinfo__city','userinfo__sex').filter(userinfo__sex=sex).annotate(num=Count('userinfo__city')).values_list('userinfo__city','num')
            else:
                #统计特定性别吸烟用户总数
                num = User.objects.all().values('userinfo__sex').filter(userinfo__sex=sex).count()
        return num
    #统计吸烟人数
    #参数: sex-按性别统计，None：全部，M：男性，F:女性
    #      group-分组，None：不分组，C:按城市分组，P：按省分组
    def getsmokecount(self,sex=None,group=None):
        user = SmokeDiabetesInfo.objects.filter(smoke=True).values_list('user')
        if sex is None:
            #所有吸烟的用户
            if group == 'P':
                #按省分组统计吸烟用户数量
                num = User.objects.filter(id__in=user).values('userinfo__province').annotate(num=Count('userinfo__province')).values_list('userinfo__province','num')
            elif group == 'C':
                #按市分组统计吸烟用户数量
                num = User.objects.filter(id__in=user).values('userinfo__city').annotate(num=Count('userinfo__city')).values_list('userinfo__city','num')
            else:
                #统计吸烟用户总数
                num = User.objects.filter(id__in=user).count()
        else:
            if group == 'P':
                #按省分组统计特定性别吸烟用户数量
                num  = User.objects.filter(id__in=user).values('userinfo__province','userinfo__sex').filter(userinfo__sex=sex).annotate(num=Count('userinfo__province')).values_list('userinfo__province','num')
            elif group == 'C':
                #按市分组统计特定性别吸烟用户数量
                num  = User.objects.filter(id__in=user).values('userinfo__city','userinfo__sex').filter(userinfo__sex=sex).annotate(num=Count('userinfo__city')).values_list('userinfo__city','num')
            else:
                #统计特定性别吸烟用户总数
                num = User.objects.filter(id__in=user).values('userinfo__sex').filter(userinfo__sex=sex).count()
        return num
    #统计饮酒人数
    #参数: sex-按性别统计，None：全部，M：男性，F:女性
    #      group-分组，None：不分组，C:按城市分组，P：按省分组
    def getdrinkcount(self,sex=None,group=None):
        user = SmokeDiabetesInfo.objects.filter(drink=True).values_list('user')
        if sex is None:
            #所有饮酒的用户
            if group == 'P':
                #按省分组统计饮酒用户数量
                num = User.objects.filter(id__in=user).values('userinfo__province').annotate(num=Count('userinfo__province')).values_list('userinfo__province','num')
            elif group == 'C':
                #按市分组统计饮酒用户数量
                num = User.objects.filter(id__in=user).values('userinfo__city').annotate(num=Count('userinfo__city')).values_list('userinfo__city','num')
            else:
                #统计饮酒用户总数
                num = User.objects.filter(id__in=user).count()
        else:
            if group == 'P':
                #按省分组统计特定性别饮酒用户数量
                num  = User.objects.filter(id__in=user).values('userinfo__province','userinfo__sex').filter(userinfo__sex=sex).annotate(num=Count('userinfo__province')).values_list('userinfo__province','num')
            elif group == 'C':
                #按市分组统计特定性别饮酒用户数量
                num  = User.objects.filter(id__in=user).values('userinfo__city','userinfo__sex').filter(userinfo__sex=sex).annotate(num=Count('userinfo__city')).values_list('userinfo__city','num')
            else:
                #统计特定性别饮酒用户总数
                num = User.objects.filter(id__in=user).values('userinfo__sex').filter(userinfo__sex=sex).count()
        return num
    #统计糖尿病人数
    #参数: sex-按性别统计，None：全部，M：男性，F:女性
    #      group-分组，None：不分组，C:按城市分组，P：按省分组
    def getdiabetescount(self,sex=None,group=None):
        user = SmokeDiabetesInfo.objects.filter(diabetes=True).values_list('user')
        if sex is None:
            #所有糖尿病的用户
            if group == 'P':
                #按省分组统计糖尿病用户数量
                num = User.objects.filter(id__in=user).values('userinfo__province').annotate(num=Count('userinfo__province')).values_list('userinfo__province','num')
            elif group == 'C':
                #按市分组统计糖尿病用户数量
                num = User.objects.filter(id__in=user).values('userinfo__city').annotate(num=Count('userinfo__city')).values_list('userinfo__city','num')
            else:
                #统计糖尿病用户总数
                num = User.objects.filter(id__in=user).count()
        else:
            if group == 'P':
                #按省分组统计特定性别糖尿病用户数量
                num  = User.objects.filter(id__in=user).values('userinfo__province','userinfo__sex').filter(userinfo__sex=sex).annotate(num=Count('userinfo__province')).values_list('userinfo__province','num')
            elif group == 'C':
                #按市分组统计特定性别糖尿病用户数量
                num  = User.objects.filter(id__in=user).values('userinfo__city','userinfo__sex').filter(userinfo__sex=sex).annotate(num=Count('userinfo__city')).values_list('userinfo__city','num')
            else:
                #统计特定性别糖尿病用户总数
                num = User.objects.filter(id__in=user).values('userinfo__sex').filter(userinfo__sex=sex).count()
        return num
    #统计高血压人数
    #参数: sex-按性别统计，None：全部，M：男性，F:女性
    #      group-分组，None：不分组，C:按城市分组，P：按省分组
    def getfatcount(self, sex=None, group=None):
        users = User.objects.all()
        user=[]
        for curuser in users:
            userdata = UserData(curuser)
            if userdata and userdata.getfat():
                user.append(userdata.getuserid())
        if sex is None:
            #所有高血压的用户
            if group == 'P':
                #按省分组统计高血压用户数量
                num = User.objects.filter(id__in=user).values('userinfo__province').annotate(num=Count('userinfo__province')).values_list('userinfo__province','num')
            elif group == 'C':
                #按市分组统计高血压用户数量
                num = User.objects.filter(id__in=user).values('userinfo__city').annotate(num=Count('userinfo__city')).values_list('userinfo__city','num')
            else:
                #统计高血压用户总数
                num = User.objects.filter(id__in=user).count()
        else:
            if group == 'P':
                #按省分组统计特定性别高血压用户数量
                num  = User.objects.filter(id__in=user).values('userinfo__province','userinfo__sex').filter(userinfo__sex=sex).annotate(num=Count('userinfo__province')).values_list('userinfo__province','num')
            elif group == 'C':
                #按市分组统计特定性别高血压用户数量
                num  = User.objects.filter(id__in=user).values('userinfo__city','userinfo__sex').filter(userinfo__sex=sex).annotate(num=Count('userinfo__city')).values_list('userinfo__city','num')
            else:
                #统计特定性别高血压用户总数
                num = User.objects.filter(id__in=user).values('userinfo__sex').filter(userinfo__sex=sex).count()
        return num
    #统计高血压人数
    #参数: sex-按性别统计，None：全部，M：男性，F:女性
    #      group-分组，None：不分组，C:按城市分组，P：按省分组
    def gethypertensioncount(self, sex=None, group=None):
        users = User.objects.all()
        user=[]
        for curuser in users:
            userdata = UserData(curuser)
            if userdata and userdata.gethypertension():
                user.append(userdata.getuserid())
        if sex is None:
            #所有高血压的用户
            if group == 'P':
                #按省分组统计高血压用户数量
                num = User.objects.filter(id__in=user).values('userinfo__province').annotate(num=Count('userinfo__province')).values_list('userinfo__province','num')
            elif group == 'C':
                #按市分组统计高血压用户数量
                num = User.objects.filter(id__in=user).values('userinfo__city').annotate(num=Count('userinfo__city')).values_list('userinfo__city','num')
            else:
                #统计高血压用户总数
                num = User.objects.filter(id__in=user).count()
        else:
            if group == 'P':
                #按省分组统计特定性别高血压用户数量
                num  = User.objects.filter(id__in=user).values('userinfo__province','userinfo__sex').filter(userinfo__sex=sex).annotate(num=Count('userinfo__province')).values_list('userinfo__province','num')
            elif group == 'C':
                #按市分组统计特定性别高血压用户数量
                num  = User.objects.filter(id__in=user).values('userinfo__city','userinfo__sex').filter(userinfo__sex=sex).annotate(num=Count('userinfo__city')).values_list('userinfo__city','num')
            else:
                #统计特定性别高血压用户总数
                num = User.objects.filter(id__in=user).values('userinfo__sex').filter(userinfo__sex=sex).count()
        return num
    #统计高脂血人数
    #参数: sex-按性别统计，None：全部，M：男性，F:女性
    #      group-分组，None：不分组，C:按城市分组，P：按省分组
    def gethyperlipemcount(self, sex=None, group=None):
        users = User.objects.all()
        user=[]
        for curuser in users:
            userdata = UserData(curuser)
            if userdata and userdata.gethyperlipem():
                user.append(userdata.getuserid())
        if sex is None:
            #所有高脂血的用户
            if group == 'P':
                #按省分组统计高脂血用户数量
                num = User.objects.filter(id__in=user).values('userinfo__province').annotate(num=Count('userinfo__province')).values_list('userinfo__province','num')
            elif group == 'C':
                #按市分组统计高脂血用户数量
                num = User.objects.filter(id__in=user).values('userinfo__city').annotate(num=Count('userinfo__city')).values_list('userinfo__city','num')
            else:
                #统计高脂血用户总数
                num = User.objects.filter(id__in=user).count()
        else:
            if group == 'P':
                #按省分组统计特定性别高脂血用户数量
                num  = User.objects.filter(id__in=user).values('userinfo__province','userinfo__sex').filter(userinfo__sex=sex).annotate(num=Count('userinfo__province')).values_list('userinfo__province','num')
            elif group == 'C':
                #按市分组统计特定性别高脂血用户数量
                num  = User.objects.filter(id__in=user).values('userinfo__city','userinfo__sex').filter(userinfo__sex=sex).annotate(num=Count('userinfo__city')).values_list('userinfo__city','num')
            else:
                #统计特定性别高脂血用户总数
                num = User.objects.filter(id__in=user).values('userinfo__sex').filter(userinfo__sex=sex).count()
        return num
4.7.4.	模板代码
模板是表现层，负责后端传来的数据通过页面(html)展示给用户及前端的交互操作，系统利用Adminlt框架统一了模板html显示风格，部分代码如下：
1、血压评估页面模板
{% extends "base_site.html" %}
{% load i18n static %}
{% block extrastyle %}{{ block.super }}
    <link rel="stylesheet" type="text/css" href="{% static "dist/css/app.css" %}">
{% endblock %}
{% block coltype %}colMS{% endblock %}
{% block bodyclass %}{{ block.super }}Home{% endblock %}
{% block content_title %} 血压健康评估 {% endblock %}
{% block breadcrumbs %}
<ol class="breadcrumb">
    <li><a href="{% url 'healthinfo:index' %}"><i class="fa fa-dashboard"></i> {% trans 'Home' %}</a></li>
    <li class="active">血压健康评估</li>
</ol>
{% endblock %}
{% block content %}
<!-- Main content -->
<section class="content">
  <div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12">
      <div class="info-box bg-red">
        <span class="info-box-icon"><i class="fa fa-comments-o"></i></span>
        <div class="info-box-content" style="text-align:center">
            <h2>血压健康评估</h2>
        </div>
        <!-- /.info-box-content -->
      </div>
      <!-- /.info-box -->
    </div>
    <!-- /.col -->
  </div>
  <div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12">
      <div class="box box-success">
        <div class="box-header with-border">
          <h3 class="box-title">血压信息</h3>
          <div class="box-tools pull-right">
            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
            <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-times"></i></button>
          </div>
        </div>
        <div class="box-body" >
          <div id="BloodPressureChart" style="width: 100%;height:300px;"></div>
        </div>
        <!-- /.box-body -->
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-4 col-xs-6">
      <!-- small box -->
      <div class="small-box bg-aqua">
        <div class="inner" >
          <h4>最近{{avgnum}}次平均收缩压(mmol/L)</h4>
          {% if assessresult is None %}   
            <h4>信息不足</h4>
            <h4>无法评估</h4>
          {% else %}
           <h3>{{assessresult.0}}</h3>
            <h4>正常收缩压:{{normaldbp.0}} - {{normaldbp.1}}mmol/L</h4>
          {% endif %}
        </div>
        <div class="progress" style="width: 95%;height:5px;margin:0 auto">
          <div class="progress-bar" style="width: 0"></div>
        </div>            
        <div class="icon">
          <i class="fa fa-h-square"></i>
        </div>
        <a class="small-box-footer" style="height:20px"></a>
      </div>
    </div>
    <!-- ./col -->
    <div class="col-lg-4 col-xs-6">
      <!-- small box -->
      <div class="small-box bg-yellow">
        <div class="inner">
          <h4>最近{{avgnum}}次平均舒张压(mmol/L)</h4>
          {% if assessresult is None %}   
            <h4>信息不足</h4>
            <h4>无法评估</h4>
          {% else %}
            <h3>{{assessresult.1}}</h3>
            <h4>正常舒张压:{{normalsbp.0}} - {{normalsbp.1}}mmol/L</h4>
          {% endif %}
        </div>
        <div class="progress" style="width: 95%;height:5px;margin:0 auto">
          <div class="progress-bar" style="width: 0"></div>
        </div>            
        <div class="icon">
          <i class="fa fa-gbp"></i>
        </div>
        <a class="small-box-footer" style="height:20px"></a>
      </div>
    </div>
    <!-- ./col -->
    <div class="col-lg-4 col-xs-6">
      <!-- small box -->
      <div class="small-box bg-green">
        <div class="inner">
          <h4>最近{{avgnum}}次平均心率(次/分)</h4>
          {% if assessresult is None %}   
            <h4>信息不足</h4>
            <h4>无法评估</h4>
          {% else %}
            <h3>{{assessresult.2}}</h3>
            <h4>正常心率:{{normalhr.0}} - {{normalhr.1}}次/分</h4>
          {% endif %}
        </div>
        <div class="progress" style="width: 95%;height:5px;margin:0 auto">
          <div class="progress-bar" style="width: 0"></div>
        </div>            
        <div class="icon">
          <i class="fa fa-heartbeat"></i>
        </div>
        <a class="small-box-footer" style="height:20px"></a>
      </div>
    </div>
    <!-- ./col -->
  </div>

  <!-- row -->
  <div class="row">
    <div class="col-md-12">
      <div class="box box-success">
        <div class="box-header">
          <i class="fa fa-bar-chart-o"></i>
          <h3 class="box-title">健康管理指导建议</h3>
          <div class="box-tools pull-right">
            <button type="button" class="btn btn-default btn-sm" data-widget="collapse"><i class="fa fa-minus"></i>
            </button>
            <button type="button" class="btn btn-default btn-sm" data-widget="remove"><i class="fa fa-times"></i>
            </button>
          </div>
        </div>
        <!-- /.box-header -->
        <div class="box-body" > 
        {% if assessresult is None%} 
          <h4>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;信息不足,无法评估!</h4> 
        {% else %}              
          <h4 style="color:#0066ff"><strong>血压健康评估：</strong></h4>
          <h4>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          您的近{{avgnum}}次平均收缩压为<strong>{{assessresult.0}}mmol/L</strong>，正常收缩压范围为{{normaldbp.0}} - {{normaldbp.1}}mmol/L，您的{{bpresult.0}}；
          您的近{{avgnum}}次平均舒张压为<strong>{{assessresult.1}}mmol/L</strong>，正常舒张压范围为{{normalsbp.0}} - {{normalsbp.1}}mmol/L，您的{{bpresult.1}}；
          {% if val %}此血压值如果在安静状态测量，且测量方法正确，根据世界卫生组织规定你可确诊为<strong>{{val}}</strong>;{% endif %} 
          您的近{{avgnum}}次平均心率为<strong>{{assessresult.2}}次/分钟</strong>，正常心率范围为{{normalhr.0}} - {{normalhr.1}}次/分钟，您{{bpresult.2}}；</h4>
         <h4 style="color:#0066ff"><strong>健康风险分析：</strong></h4>  
          {% for risk in risks %}
            <h4>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ risk.0 }}</h4>  
          {% endfor %}
          <h4 style="color:#0066ff"><strong>健康指导建议：</strong></h4>  
          {% for intervent in intervents %}
            <h4>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{ intervent.0 }}</h4>  
          {% endfor %}
        {% endif %}
      </div>  
        <!-- /.box-body -->
      </div>
      <!-- /.box -->
    </div>
    <!-- /.col -->
  </div>
  <!-- /.row -->
</section>
<!-- /.content -->
</div>
{% endblock %}
{% block extrajs %}
2、高脂血人群分布分析页面模板
{% extends "base_site.html" %}
{% load i18n static %}
{% block extrastyle %}{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static "dist/css/app.css" %}">
{% endblock %}
{% block coltype %}colMS{% endblock %}
{% block bodyclass %}{{ block.super }}Home{% endblock %}
{% block content_title %} 高脂血人群分布分析 {% endblock %}
{% block breadcrumbs %}
<ol class="breadcrumb">
  <li><a href="{% url 'healthinfo:index' %}"><i class="fa fa-dashboard"></i> {% trans 'Home' %}</a></li>
  <li class="active">高脂血人群分布分析</li>
</ol>
{% endblock %}
{% block content %}
<!-- Main content -->
<section class="content">
  <div class="row">
    <div class="col-md-12 col-sm-12 col-xs-12">
      <div class="box box-success">
        <div class="box-body">
          {% if dataset is None %}   
            <h3>信息不足</h3>
            <h3>无法分析</h3>
          {% endif %}
          <div id="mapBox" style="width: 100%;height: 580px;"></div>
        </div>
        <!-- /.box-body -->
      </div>
    </div>
  </div>
</section>
<!-- /.content -->

{% endblock %}
{% block extrajs %}
4.7.5.	前端动态绘图显示代码
系统前端利用Echart库实现了健康数据的动态图形显示，下面以高脂血人群中国地图和BMI、体重、身高、腰围折线图为例，说明实现过程，代码如下：
1、高脂血人群中国地图Echart绘图代码
<script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
<script src="{% static 'dist/js/china.js' %}"></script>
<script src="{% static 'plugins/jquery-knob/js/jquery.knob.js' %}"></script>
<script>
  $(function () {
    // 初始化echarts实例
    let mapBoxEchart = echarts.init(document.getElementById('mapBox'));
    // 指定相关的配置项和数据
    let mapBoxOption = {
      backgroundColor: '#FFFFFF',
      title: {
        text: '高脂血人群分布图',
      //  subtext: '',
        x: 'center',
        y: '7%',
      },
      tooltip: {
        trigger: 'item',
        formatter: '{b}: {c}人'
      },
      toolbox: {
        show: true,
        orient: 'vertical',
        left: 'right',
        top: 'center',
        feature: {
          dataView: { readOnly: false },
          restore: {},
          saveAsImage: {}
        }
      },
      visualMap: {
        min: 0,
        max: {{valmax}},
        left: 'left',
        top: 'bottom',
        text: ['高', '低'],
        inRange: {
          color: ['lightskyblue', 'yellow', 'orangered']
          //color: ['#e0ffff', '#006edd']
        },
        show: true
      },      
      geo: {
        map: 'china',
        roam: true,
        zoom: 1.10,
        label: {
          normal: {
            show: true,
            fontSize: '10',
            color: 'rgba(0,0,0,0.7)',
          }
        },
        itemStyle: {
          normal: {
            borderColor: 'rgba(0, 0, 0, 0.2)',
            areaColor: "#ffefd5", //区域颜色
          },
          emphasis: {
            areaColor: '#F3B329',
            shadowOffsetX: 0,
            shadowOffsetY: 0,
            shadowBlur: 20,
            borderWidth: 0,
            shadowColor: 'rgba(0, 0, 0, 0.5)'
          }
        }
      },
      series: [
        {
          name: '用户数',
          type: 'map',
          geoIndex: 0,
          data: {{ dataset|safe }},
        }
      ],
    };

    // 使用指定的配置项和数据显示图表。
    mapBoxEchart.setOption(mapBoxOption);
    window.addEventListener('resize', () => {
      mapBoxEchart.resize()
    })
  });

</script>
2、BMI、体重、身高、腰围折线图代码
<script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
<script src="{% static 'plugins/jquery-knob/js/jquery.knob.js' %}"></script>
<script>
//bmi、体重、身高、腰围echartline图
$(function () {
  // 基于准备好的dom，初始化echarts实例
  let myChart = echarts.init(document.getElementById('bodyChart'));
// 指定图表的配置项和数据
  let option = {
    title: [
        {text: '体质指数(BMI)',left:'8%',top:-4},
        {text: '体重',left:'36%',top:-4},
        {text: '身高',left:'61%',top:-4},
        {text: '腰围',left:'86%',top:-4}
      ],
    dataset:{
      source:{% autoescape off %}{{ bddataset }}{% endautoescape %}
    },
    tooltip: {
        trigger: 'axis',
        axisPointer: {
            type: 'cross',
            label: {backgroundColor: '#6a7985'}
        }
    },
    legend: {show:false},
    toolbox: {
      feature: {saveAsImage: {}}
    },
    grid: [
        { show:true, top:'10%',bottom:'5%',left: ' 3%',width: '20%', height: '80%'},
        { show:true, top:'10%',bottom:'5%',left: '28%',width: '20%', height: '80%'},
        { show:true, top:'10%',bottom:'5%',left: '53%',width: '20%', height: '80%'},
        { show:true, top:'10%',bottom:'5%',left: '78%',width: '20%', height: '80%'}
    ],
    xAxis:[ 
        {gridIndex: 0,type: 'category'},
        {gridIndex: 1,type: 'category'},
        {gridIndex: 2,type: 'category'},
        {gridIndex: 3,type: 'category'}
    ],
    yAxis:[
        {gridIndex: 0,type: 'value',min:function (value) {return Math.round(value.min) - 2;},max:function (value) {return Math.round(value.max) + 2;}},
        {gridIndex: 1,type: 'value',min:function (value) {return Math.round(value.min) - 5;},max:function (value) {return Math.round(value.max) + 5;}},
        {gridIndex: 2,type: 'value',min:function (value) {return Math.round(value.min) - 5;},max:function (value) {return Math.round(value.max) + 5;}},
        {gridIndex: 3,type: 'value',min:function (value) {return Math.round(value.min) - 2;},max:function (value) {return Math.round(value.max) + 2;}},
    ],
    series: [
        {name:'BMI',type: 'line', seriesLayoutBy: 'row', xAxisIndex: 0,yAxisIndex: 0, encode: {x: 0,y: 4,}},
        {name:'体重',type: 'line', seriesLayoutBy: 'row', xAxisIndex: 1,yAxisIndex: 1, encode: {x: 0,y: 2,}},
        {name:'身高',type: 'line', seriesLayoutBy: 'row', xAxisIndex: 2,yAxisIndex: 2, encode: {x: 0,y: 1,}},
        {name:'腰围',type: 'line', seriesLayoutBy: 'row', xAxisIndex: 3,yAxisIndex: 3, encode: {x: 0,y: 3,}}
    ]
  };

  // 使用指定的配置项和数据显示图表。
  myChart.setOption(option);
  window.addEventListener('resize', () => {
    myChart.resize()
  })
});
</script>

{% endblock %}
 

5. 系统测试
   系统测试是针对整个系统进行的测试，目的是验证系统是否满足了需求规格的定义，找出与需求规格不相符合或与之矛盾的地方，包括了功能测试和系统测试两部分。
   5.1.	系统测试环境
   通过将PC机安装健康管理分析系统作为服务器联入家庭无线网，利用笔记本电脑、iPad、手机接入家庭无线网作为客户端，利用浏览器访问，构成测试环境。
   5.1.1.	测试的硬件环境
   服务器使用台式计算机 代替，CPU为Intel Core i7-2600@3.4GHz，内存8G，硬盘512G，客户端分别使用了Thinkpad X1、iPad mini2、手机等设备。
   5.1.2.	测试的软件环境
   服务器操作系统为Windows10专业版，mysql8.0.11，python 3.7.3，django3.0.4，mysqlclient1.4.6，numpy1.16.3。
   客户端Windows10 IE11.836.18362.0、Edge 44.18362.449.0、Google Chrome 83.0.4103.97正式64位版本；IOS Safari浏览器。
   5.1.3.	测试的网络环境
   作为服务器的PC机和笔记本、iPad、手机通过WIFI接入同一无线路由器中，IP为同一子网，通过DHCP服务自动获取。
   5.2.	系统测试内容
   系统测试主要包括了两部分内容功能测试和系统测试：
   1、功能测试：对当前软件主体功能进行了验证，覆盖系统的六个子系统的内容。
   1）健康信息管理：分别对基本信息、吸烟糖尿病史信息、身高体重信息、血压信息、血脂信息等个人健康数据的新增、删除、修改、查询功能进行功能测试
   2）健康标准管理功能测试：针对BMI体重健康评估标准、单项评估标准、ICVD年龄评估标准、ICVD体重评估标准、ICVD吸烟评估标准、ICVD糖尿病评估标准、ICVD血压评估标准、ICVD血脂评估标准、ICVD十年发病风险评估标准、ICVD十年发病分线常规标准、健康指标分类、健康风险分析、健康风险干预等健康标准、健康分析参数、健康干预建议等健康标准数据的新增、删除、修改、查询功能进行功能测试。
   3）健康评估测试：针对对日常健康评估、BMI体重健康评估、血压健康评估、血脂健康评估、缺血性心血管病发病风险评估等功能进行功能测试。
   4）健康分析测试：针对对吸烟人群分布分析、饮酒人群分布分析、肥胖人群分布分析、糖尿病人群分布分析、高血压人群分布分析和高血脂人群分布分析和不良习惯和慢性病人群分布的综合分析等功能进行测试
   5）用户和权限管理功能：分别对用户注册、用户登陆、用户注销、密码修改、用户组管理、用户管理、用户权限的管理等进行功能测试。
   6）系统设置测试：对系统的设置管理功能进行功能测试。
   2、系统测试：
   1）易用性测试：验证系统界面设计一致性、术语的规范性、输入显示的正确性、可理解性、一致性
   2）兼容性测试：验证当前系统在不同的环境下使用情况。分别对个人电脑、iPad、手机的window、IOS系统下的主流浏览器IE、Edge、Chrome、Safari浏览进行行了兼容性测试。
   3）安全性测试：系统的安全性分别对用户密码数据库存储加密，非授权用户访问等功能进行了安全性测试，保证系统的安全。
   5.3.	系统测试方法
   系统测试采用了黑盒测试和白盒测试相结合的方式，对系统进行测试。
   黑盒测试也称为功能测试或数据驱动测试，它是在已知产品所应具有的功能，通过测试来检测每个功能是否都能正常使用，在测试时，把程序看作一个不能打开的黑盆子，在完全不考虑程序内部结构和内部特性的情况下，在程序接口进行测试，它只检查程序功能是否按照需求规格说明书的规定正常使用，程序是否能适当地接收输入数锯而产生正确的输出信息，并且保持外部信息（如数据库或文件）的完整性。黑盒测试方法主要有等价类划分、边值分析、因果图、错误推测等，主要用于软件确认测试。“黑盒”法着眼于程序外部结构、不考虑内部逻辑结构、针对软件界面和软件功能进行测试。“黑盒”法是穷举输入测试，只有把所有可能的输入都作为测试情况使用，才能以这种方法查出程序中所有的错误。
   白盒测试也称结构测试或逻辑驱动测试，它是基于系统的内部工作过程，可通过测试来检测系统内部动作是否按照规格说明书的规定正常进行，按照程序内部的结构测试程序，检验程序中的每条通路是否都有能按预定要求正确工作，而不顾它的功能，白盒测试的主要方法有逻辑驱动、基路测试等，主要用于软件验证。“白盒”法全面了解程序内部逻辑结构、对所有逻辑路径进行测试。“白盒”法是穷举路径测试。通过检查程序的内部结构，从检查程序的逻辑着手，得出测试数据。
   5.4.	系统测试数据
   由于个人健康数据属于个人隐私，因此直接获取较为困难，因此为了进行测试，系统开发和测试过程中使用Python的Faker库，编写测试数据生成程序，自动生成所需的测试数据。
   使用前需先安装Faker，安装命令： pip install Faker
   1、测试数据生成系统初始化
   import os
   import random
   import datetime
   import django
   from django.utils import timezone
   from faker import Faker
   from dateutil.relativedelta import relativedelta
   fake = Faker("zh_CN")
   os.environ.setdefault("DJANGO_SETTINGS_MODULE", "healthmanage.settings")
   django.setup()
   from django.contrib.auth.models import User
   from django.contrib.auth.models import Group,Permission
   from django.db import models
   from adminlteui.models import Options, Menu, ContentType
   from healthinfo.models import UserInfo, BodyInfo, BloodPressure,Bcholesterin,SmokeDiabetesInfo,Bcholesterin
   from healthinfo.models import AgeScale,WeightScale,BloodPressureScale,SmokeScale,DiabetesScale
   from healthinfo.models import RiskEvaluatScale, CommonRiskScale,TCScale,BMIScale
   from healthinfo.models import HealthIntervent,RiskAnalyse,SingleAssess,Indicator
   citys = { }
   2、生成用户个人健康数据函数
   #随机生成用户数据
   #参数：num-生成用户的数量，days-生成数据的天数
   def createuserdata(num,days):

   while num > 0:
       username = fake.user_name()
       username = 'user'+str(num).zfill(4)
       if len(username)<8:
           username += str(fake.random_number(digits=(8-len(username))))
       if User.objects.filter(username=username).count()==0:
           num = num - 1
           sex = random.choice(('M', 'F'))
           if sex=='M':
               firstname = fake.first_name_male()
           else:
               firstname = fake.first_name_female()
           lastname = fake.last_name()
           ssn=fake.ssn()
           birthday =datetime.datetime.strptime(ssn[6:14], '%Y%m%d')
           email=fake.email()
           province = random.choice(list(citys.keys()))
           city=random.choice(citys[province])
           job=fake.job()
           phone = fake.phone_number()
           address = fake.address()
           org = fake.company()
           print(username,ssn,lastname,firstname,sex,birthday,email,phone,address,org,province,city,job)
           #注册用户
           user=User.objects.create_user(username=username,password='!qq12345',email=email,last_name=lastname,first_name=firstname,is_staff=True,) 
           group = Group.objects.get(name='个人用户') 
           group.user_set.add(user)

           #生成用户信息
           userinfo=UserInfo(user=user,ssn=ssn,sex=sex,birthday=birthday,phone=phone,org=org,job=job,province=province,city=city,address=address)
           userinfo.save()
           max=datetime.date.today().year - birthday.year
           if max < 15:
               smoke=False
               drink=False
           else:
               smoke = random.choice((True, False))
               drink = random.choice((True, False))
           if smoke:
               smokestart = birthday + relativedelta(years=fake.random_int(max=max, min=1))
           else:
               smokestart = None
           if drink:
               drinkstart = birthday + relativedelta(years=fake.random_int(max=max, min=1))
           else:
               drinkstart = None
           diabetes = random.choice((True, False))
           if diabetes:
               diabetesstart = birthday + relativedelta(years=fake.random_int(max=datetime.date.today().year - birthday.year, min=0))
           else:
               diabetesstart = None
           smokediabetes = SmokeDiabetesInfo(user=user, smokestart=smokestart, smoke=smoke, drink =drink,drinkstart =drinkstart,diabetesstart=diabetesstart,diabetes=diabetes)
           smokediabetes.save()
           startdate=timezone.now()
           #生成身高体重数据
           v1 = fake.random_int(max=180,min=150) 
           bmi=random.uniform(14,45)
           v2 =  v1/100*v1/100*bmi
           nomalheight = pow(v2 / bmi, 0.5) * 100
           
           v3 = fake.random_int(max=105,min=95)*0.42*nomalheight/100
           i=0
           while i<days:
               curdate= startdate-relativedelta(days=i)
               i += 1
               x1 = round(v1+random.random()*random.choice((-1,1)),2)
               x2 = round(v2+ random.uniform(0,3)*random.choice((-1,1)),2)
               x3 = round(v3+ random.uniform(0,3)*random.choice((-1,1)),2)
               print(curdate,x1,x2,x3)
               modobj=BodyInfo(user=user,measuretime=curdate,height = x1,weight =x2,waist = x3)
               modobj.save()
           #生成血压数据
           v1 = fake.random_int(max=180,min=70) 
           v2 = v1-fake.random_int(max=50,min=30) 
           v3 = fake.random_int(max=90,min=40)
           i=0
           while i<days:
               curdate= startdate-relativedelta(days=i)
               i += 1
               x1 = v1+random.randint(0,10)*random.choice((-1,1))
               x2 = v2+random.randint(0,10)*random.choice((-1,1))
               x3 = v3+random.randint(0,5)*random.choice((-1,1))
               print(curdate,x1,x2,x3)
               modobj=BloodPressure(user=user,measuretime=curdate,DBP = x1,SBP =x2,HR = x3)
               modobj.save()
       
           #生成血脂数据
           v1 = random.uniform(0.15,4)
           v2 = random.uniform(1.5,6.5) 
           v3 = random.uniform(0.8,2)
           v4 = random.uniform(0.3,2.2)
           i=0
           while i<days:
               curdate= startdate-relativedelta(months=i)
               i += 1
               x1 = round(v1+random.uniform(0.015,0.2)*random.choice((-1,1)),2)
               x2 = round(v2+random.uniform(0.15,0.4)*random.choice((-1,1)),2)
               x3 = round(v3+random.uniform(0.02,0.2)*random.choice((-1,1)),2)
               x4 = round(v4+random.uniform(0.03,0.2)*random.choice((-1,1)),2)
               print(curdate,x1,x2,x3,x4)
               modobj=Bcholesterin(user=user,measuretime=curdate,LDL = x1,TC =x2,HDL = x3,TG = x4)
               modobj.save()
   3、健康标准管理数据生成函数
   其中健康标准参考了国家健康管理师中健康标准及相关分分类标准。
   def createscale():
   print("清除所有评价标准表数据")
   AgeScale.objects.all().delete()
   WeightScale.objects.all().delete()
   BloodPressureScale.objects.all().delete()
   TCScale.objects.all().delete()
   RiskEvaluatScale.objects.all().delete()
   CommonRiskScale.objects.all().delete()
   SmokeScale.objects.all().delete()
   DiabetesScale.objects.all().delete()
   BMIScale.objects.all().delete()
   RiskAnalyse.objects.all().delete()
   HealthIntervent.objects.all().delete()
   SingleAssess.objects.all().delete()
   Indicator.objects.all().delete()

   print("增加 {} 数据".format(Indicator._meta.verbose_name))
   parents=['危险因素','BMI评价']
   childs=[['吸烟','危险因素'],
           ['饮酒','危险因素'],
           ['糖尿病','危险因素'],
           ['体重消瘦','危险因素'],
           ['体重肥胖','危险因素'],
           ['体重偏瘦','BMI评价'],
           ['体重正常','BMI评价'],
           ['体重偏胖','BMI评价'],
           ['I度肥胖','BMI评价'],
           ['II度肥胖','BMI评价'],
           ['III度肥胖','BMI评价'],
           ['低血压','危险因素'],
           ['高血压','危险因素'],        
           ['高脂血','危险因素'],
           ['低脂血','危险因素'],
           ['心动过速','危险因素'],
           ['心动过缓','危险因素'],]
   for parent in parents:
       Indicator.objects.get_or_create(name=parent)
   for child in childs:
       id=Indicator.objects.filter(name=child[1]).first()
       Indicator.objects.get_or_create(name=child[0],parent=id)

   print("增加 {} 数据".format(AgeScale._meta.verbose_name))
   for line in lines:
       AgeScale.objects.get_or_create(sex = line[0],maxv =line[1],score =line[2]) 

   print("增加 {} 数据".format(WeightScale._meta.verbose_name))
   lines = [
       ['M',24,0],
       ['M',28,1],
       ['M',50,2],
       ['F',24,0],
       ['F',28,1],
       ['F',50,2]]
   for line in lines:
       WeightScale.objects.get_or_create(sex = line[0],maxv =line[1],score =line[2]) 

   print("增加 {} 数据".format(BloodPressureScale._meta.verbose_name))
   lines = [
       ['M',120,-2],
       ['M',130,0],
       ['M',140,1],
       ['M',160,2],
       ['M',180,5],
       ['M',280,8],
       ['F',120,-2],
       ['F',130,0],
       ['F',140,1],
       ['F',160,2],
       ['F',180,3],
       ['F',280,4]]
   for line in lines:
       BloodPressureScale.objects.get_or_create(sex = line[0],maxv =line[1],score =line[2]) 

   print("增加 {} 数据".format(TCScale._meta.verbose_name))
   lines = [
       ['M',5.18,0],
       ['M',10,1],
       ['F',5.18,0],
       ['F',10,1]]
   for line in lines:
       TCScale.objects.get_or_create(sex = line[0],maxv =line[1],score =line[2]) 

   print("增加 {} 数据".format(RiskEvaluatScale._meta.verbose_name))
   for line in lines:
       RiskEvaluatScale.objects.get_or_create(sex = line[0],risk =line[2],score =line[1]) 

   print("增加 {} 数据".format(CommonRiskScale._meta.verbose_name))
   lines = [
       ['M',40,1,0.3],
       ['M',45,1.4,0.4],
       ['M',50,1.9,0.5],
       ['M',55,2.6,0.7],
       ['M',120,3.6,1],
       ['F',40,0.3,0.1],
       ['F',45,0.4,0.1],
       ['F',50,0.6,0.2],
       ['F',55,0.9,0.3],
       ['F',120,1.4,0.5]]
   for line in lines:
       CommonRiskScale.objects.get_or_create(sex = line[0],age =line[1],avgrisk =line[2],minrisk=line[3]) 

   print("增加 {} 数据".format(SmokeScale._meta.verbose_name))
   SmokeScale.objects.get_or_create(sex = 'M',smoke =False,score =0) 
   SmokeScale.objects.get_or_create(sex = 'M',smoke =True,score =2) 
   SmokeScale.objects.get_or_create(sex = 'F',smoke =False,score =0) 
   SmokeScale.objects.get_or_create(sex = 'F',smoke =True,score =1) 

   print("增加 {} 数据".format(DiabetesScale._meta.verbose_name))
   DiabetesScale.objects.get_or_create(sex = 'M',diabetes =False,score =0) 
   DiabetesScale.objects.get_or_create(sex = 'M',diabetes =True,score =1) 
   DiabetesScale.objects.get_or_create(sex = 'F',diabetes =False,score =0) 
   DiabetesScale.objects.get_or_create(sex = 'F', diabetes=True, score=2)

   print("增加 {} 数据".format(BMIScale._meta.verbose_name))
   lines = [
       ['体重偏瘦',18.5],
       ['体重正常',24],
       ['体重偏胖',27],
       ['I度肥胖',30],
       ['II度肥胖',40],
       ['III度肥胖',50]]
   for line in lines:
       wtype=Indicator.objects.filter(name=line[0]).first()
       BMIScale.objects.get_or_create(wtype = wtype,bmi =line[1]) 

   print("增加 {} 数据".format(SingleAssess._meta.verbose_name))
   lines = [
       ['血压','收缩压',90,140],
       ['血压','舒张压',60,90],
       ['血压','心率',60,100],
       ['血脂', '总胆固醇', 2.35, 5.18],
       ['血脂','低密度',0.25,3.11],
       ['血脂','高密度',1.16,1.42],
       ['血脂','甘油三酯',0.51,1.7],]
   for line in lines:
       SingleAssess.objects.get_or_create(assesstype = line[0],assessname=line[1],minv=line[2],maxv=line[3]) 

   print("增加{}、{}数据".format(RiskAnalyse._meta.verbose_name,HealthIntervent._meta.verbose_name))
   for line in lines:
       hmtype=Indicator.objects.filter(name=line[0]).first()
       if hmtype:
           print(type(hmtype),line[0],line[1])
           RiskAnalyse.objects.get_or_create(hmtype = hmtype,risk =line[1])
   for intervent in intervents:
       hmtype=Indicator.objects.filter(name=intervent[0]).first()
       HealthIntervent.objects.get_or_create(hmtype = hmtype,intervent =intervent[1])
   5.5.	系统测试结果分析
   1、功能性测试结果
   对健康管理分析系统进行了功能性测试，通过对健康信息（基本信息、吸烟糖尿病史信息、身高体重信息、血压信息、血脂信息5个模块）、健康评估（日常健康评估、BMI体重健康评估、血压健康评估、血脂健康评估、缺血性心血管病发病风险评估5个模块）、健康标准（BMI体重健康评估标准、单项评估标准、ICVD年龄评估标准、ICVD体重评估标准、ICVD吸烟评估标准、ICVD糖尿病评估标准、ICVD血压评估标准、ICVD血脂评估标准、ICVD十年发病风险评估标准、ICVD十年发病分线常规标准、健康指标分类、健康风险分析、健康风险干预等健康标准、健康分析参数、健康干预建议13个模块）、健康分析（吸烟人群分布分析、饮酒人群分布分析、肥胖人群分布分析、糖尿病人群分布分析、高血压人群分布分析和高血脂人群分布分析和不良习惯和慢性病人群分布的综合分析7个模块）、认证授权（用户注册、用户登陆、用户注销、密码修改、用户组管理、用户管理、用户权限7子模块）、系统设置（基本设置、选项设置、菜单设置3个模块）六个子系统40个模块进行测试，发现无数据系统异常未处理、用户错误输入缺少验证、无数据绘图错误、数据超出范围、绘图图例错误等，错误67项，修改错误67项，最终结果满足用户需求。
   2、易用性测试
   对健康管理分析系统进行易用性测试，系统界面风格均采用Adminlte模板设置，人机界面简洁、美观、实用，风格相对一致，符合常用网页操作习惯，页面结构、导航、菜单、链接、搜索、翻页、字体、列表风格一致；在页面浏览时具有必要的信息，指导用户使用程序，系统界面均具有提示操作信息，方便指导用户操作；在界面、人机交互、输出中的用语应与业务用语一致，简洁易懂，方便使用；输入、输出设计规范，输出结果简洁、直观、美观、方便阅读、易懂和使用；执行不可逆删除操作时，系统给出相应提示，再次确认；系统提供辅助输入手段（如选择输入、默认值等），提供灵活的数据检索功能，数据检索方便、灵活，设计满足用户的需求。
   3、安全性测试
   通过健康管理分析系统进行安全性测试，包括不登陆直接URL路径访问、登陆后非授权信息访问、用户简单密码、无密码登陆、数据库密码存储加密等内容，系统达到用户需求。
   4、兼容性测试
   健康管理分析系统兼容性测试分别利用个人电脑、iPad、手机的window、IOS系统下的主流浏览器IE、Edge、Chrome、Safari浏览进行行了兼容性测试，测试满足用户需求。
    

7.	参考文献

[1]刘晖.医养服务智慧健康管理系统的构建与思考[J].湖南工程学院学报(自然科学版),2020,30(01):57-60.
[2]于淑云.移动端个人健康管理系统技术浅析[J].信息与电脑(理论版),2019,31(23):38-39.
[3]沈杰.计算机软件在我国健康管理服务中的应用分析[J].中国卫生产业,2019,16(34):174-176.
[4]王伟超. 健康管理软件的设计与实现[D].郑州大学,2017.
[5]李春英,张巍巍.全球大数据与健康管理的研究热点聚类分析[J].中国医院管理,2016,36(10):63-65.
[6]雷蕾. 面向社区居民的健康管理系统的研究与分析[D].云南大学,2016.
[7]王叶,肖晓旦.健康管理系统研究可视化分析[J].情报工程,2016,2(02):88-96.
[8]崔志敏. 基于数据挖掘的健康管理系统[D].河北科技大学,2015.
[9]苏航,刘欣悦,郭载勋,杨琳,武晓君,李锟,方丽英.高校健康管理信息系统的分析与设计[J].中国医学装备,2014,11(07):20-23.
[10]赵京宁,张锦,倪嘉麟,贺丽萍.健康管理系统在体检中心的应用分析[J].解放军医院管理杂志,2011,18(02):140-141.
[11] Django 教程https://www.liujiangblog.com/course/django/84
[12] 第四章系统分析（自编教材）